<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Hawkular - Monitoring a SwitchYard Application using Hawkular BTM 0.1.0.Final</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- css -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link href="../../../../css/tabzilla.css" rel="stylesheet">
    <link href="../../../../css/styles.css" rel="stylesheet">
    <link href="../../../../css/prettify.css" rel="stylesheet">
    <link href="../../../../css/ekko-lightbox.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
    <script src="../../../../js/moment.min.js"></script>
    <script src="../../../../js/jquery-1.11.2.min.js"></script>

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../../favicon.ico">
    
  </head>
  <body onload="prettyPrint()" data-spy="scroll" data-offset="80" data-target="#toc">

	
<!-- Fixed navbar -->
<nav class="navbar navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <a class="navbar-brand" href="../../../..//">Home</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="../../../../blog.html" role="button">Blog</a></li>
        <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
          Community
          <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" role="menu">
            <li class="menu-item">
              <a href="../../../../community/docs/getting-involved/">Getting Involved</a>
            </li>
            <li class="menu-item">
              <a href="../../../../community/docs/developer-guide/">Developer Guide</a>
            </li>
            <li class="menu-item dropdown dropdown-submenu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Labs</a>
                <ul class="dropdown-menu">
                  <li class="menu-item ">
                    <a href="../../../../community/labs/datamining/">Datamining</a>
                  </li>
                  <li class="menu-item ">
                    <a href="https://github.com/pilhuhn/hawkfx">HawkFX</a>
                  </li>
                  <li class="menu-item ">
                    <a href="../../../../hawkular-clients/android-client/">Android client</a>
                  </li>
                  <li class="menu-item ">
                    <a href="https://github.com/jotak/hawkular-java-toolbox">Client-side java toolbox</a>
                  </li>
                </ul>
            </li>
            <li>
              <a href="https://github.com/hawkular">GitHub Repositories</a>
            <li>
              <a href="https://travis-ci.org/hawkular">CI Builds</a>
            </li>
          </ul>
        </li>
      </ul>
      <div id="wrap">
        <div class="dropup">
          <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
          <script>
            window.addEventListener('load', function() {
              renderTabzilla("Hawkular", "https://hawkular.github.io", true );
            }, false);
          </script>
        </div>
      </div>
    </div>
</nav>

    <section class="main-banner blog-mainbanner">
        <div class="container">
            <h1>Monitoring a SwitchYard Application using Hawkular BTM 0.1.0.Final</h1>
            <p>A blog post by Gary Brown</p>
<!-- show tags for this page -->
   <p> 
      <a href="/tags/btm.html">btm</a> 
          |
      <a href="/tags/demo.html">demo</a> 
  </p>
        </div>
    </section>

    <div class="blog-container">
        <br/><br/>
    	<p><div class="paragraph">
<p>Hawkular BTM 0.1.0.Final is the first release of the Hawkular Business Management project, and therefore currently only provides a minimal level of functionality. However despite the early stage of the project, this post will show how a business transaction implemented using SwitchYard can be monitored across two separate applications using JMS and Web Services.</p>
</div>
<div class="paragraph">
<p>This post assumes that the Hawkular BTM 0.1.0.Final distribution has been downloaded and unzipped, and the <strong><em>BTM_HOME</em></strong> environment variable setup, as described in the <a href="http://www.hawkular.org/docs/components/btm/index.html">user documentation</a>. The environment being monitored is <strong>SwitchYard 2.0.0.Final</strong> installed in <strong>Wildfly 8.1.0.Final</strong>.</p>
</div>
<div class="paragraph">
<p>For this post, we will be deploying the SwitchYard <em>quickstarts/demos/multiApp</em> example. Once SwitchYard has been installed in Wildfly, follow the instructions in the <em>multiApp/README.md</em> to deploy the application into Wildfly. Once deployed, stop the Wildfly server.</p>
</div>
<div class="paragraph">
<p>From a command window in the Wildfly <em>bin</em> folder, run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">. $BTM_HOME/client/env.sh
./standalone.sh -c standalone-full.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Simple as that! Now the Wildfly server, running the SwitchYard application, has been instrumented (using <a href="http://byteman.jboss.org/">ByteMan</a>) to capture some information relevant for Business Transaction Management. However before performing any transactions we need to startup the Business Transaction Management Server. Go to the BTM distribution&#8217;s root folder and run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">bin/standalone.sh -Dkeycloak.import=standalone/configuration/hawkular-realm.json \
                             -Djboss.socket.binding.port-offset=100</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>keycloak.import</em> argument is only required when starting the server for the first time, and initialises Hawkular Accounts (including setting up a default user <strong>jdoe</strong> with password <strong>password</strong>).</p>
</div>
<div class="paragraph">
<p>Now we are ready to perform a business transaction instance. Open a command window in the SwitchYard <em>quickstarts/demos/multiApp</em> folder and run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">mvn exec:java -Pwildfly --settings ../../settings.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>That should return with a XML document indicating that the order has been accepted.</p>
</div>
<div class="paragraph">
<p>Now issue the following command, to request a list of business transaction fragments from the Business Transaction Management Server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">curl -X GET -u jdoe:password http://localhost:8180/hawkular/btm/transactions | python -m json.tool</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will generate two business transaction fragments, the first for the OrderService web service, and the second for the JMS application that receives the order and then invokes the OrderService web service. See the <a href="data/blog/2015/btm/hawkular-btm-0.1.0-demo.json">full JSON here</a>.</p>
</div>
<div class="paragraph">
<p>The condensed and annotated version of the first fragment is:</p>
</div>
<div class="listingblock">
<div class="title">First business transaction fragment</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-json" data-lang="json">    {
        "id": "9d037fcc-d3fc-4b51-a273-ae05d762ad32", <b class="conum">(1)</b>
        "nodes": [
            {
                "correlationIds": [
                    {
                        "scope": "Interaction",
                        "value": "d9c727d6-9688-4206-8db5-226fe73abb79" <b class="conum">(2)</b>
                    }
                ],
                "details": {
                    "btm_source": "javax-servlet", <b class="conum">(3)</b>
                    "remoteAddr": "127.0.0.1",
                    "remoteHost": "127.0.0.1"
                },
                "startTime": 1435758196356,
                "type": "Consumer",
                "uri": "http://localhost:8080/quickstart-demo-multiapp/OrderService",
                "duration": 391,
                "endpointType": "HTTP",
                "nodes": [
                    {
                        "details": {
                            "btm_source": "switchyard"
                        },
                        "operation": "submitOrder", <b class="conum">(4)</b>
                        "startTime": 1435758196555,
                        "type": "Service",
                        "uri": "{urn:switchyard-quickstart-demo:multiapp:0.1.0}OrderService",
                        "duration": 96,
                        "nodes": [
                            {
                                "details": {
                                    "btm_source": "switchyard"
                                },
                                "duration": 17,
                                "nodes": [],
                                "operation": "lookupItem", <b class="conum">(4)</b>
                                "startTime": 1435758196565,
                                "type": "Service",
                                "uri": "{urn:switchyard-quickstart-demo:multiapp:0.1.0}OrderService/InventoryService"
                            }
                        ]
                    }
                ]
            }
        ]
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Each business transaction fragment has a unique id</p>
</li>
<li>
<p>This interaction based correlation id will link this business transaction fragment with the web service invocation in the second fragment below</p>
</li>
<li>
<p>Each node can provide additional details, which includes the <em>btm_source</em> used to identify the technology that generated the node</p>
</li>
<li>
<p>This fragment shows one SwitchYard Service (OrderService) calling another SwitchYard Service (OrderService/InventoryService)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The condensed and annotated version of the second fragment is:</p>
</div>
<div class="listingblock">
<div class="title">Second business transaction fragment</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-json" data-lang="json">    {
        "id": "bc832ed0-787d-47f0-993d-f37c1ca58b95",
        "nodes": [
            {
                "details": {
                    "btm_source": "javax-jms"
                },
                "startTime": 1435758194986,
                "type": "Consumer",
                "uri": "HornetQQueue[OrderRequestQueue]", <b class="conum">(1)</b>
                "duration": 1904,
                "endpointType": "JMS",
                "nodes": [
                    .... (removed nodes associated with camel components)
                        "nodes": [
                            {
                                "details": {
                                    "btm_source": "switchyard"
                                },
                                "operation": "submitOrder", <b class="conum">(2)</b>
                                "startTime": 1435758195245,
                                "type": "Service",
                                "uri": "{urn:switchyard-quickstart-demo:multiapp:0.1.0}OrderInput",
                                "duration": 1524,
                                "nodes": [
                                     .... (removed nodes associated with camel components)
                                        "nodes": [
                                            {
                                                "details": {
                                                    "btm_source": "switchyard"
                                                },
                                                "operation": "submitOrder", <b class="conum">(3)</b>
                                                "startTime": 1435758195310,
                                                "type": "Service",
                                                "uri": "{urn:switchyard-quickstart-demo:multiapp:0.1.0}OrderInputComponent/OrderWebService",
                                                "duration": 1454,
                                                "nodes": [
                                                    {
                                                        "correlationIds": [
                                                            {
                                                                "scope": "Interaction",
                                                                "value": "d9c727d6-9688-4206-8db5-226fe73abb79" <b class="conum">(4)</b>
                                                            }
                                                        ],
                                                        "details": {
                                                            "btm_source": "java-httpurlconnection",
                                                            "http_method": "POST"
                                                        },
                                                        "duration": 35,
                                                        "endpointType": "HTTP",
                                                        "startTime": 1435758196129,
                                                        "type": "Producer",
                                                        "uri": "http://localhost:8080/quickstart-demo-multiapp/OrderService"
                                                    }
                    ....
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The business transaction is initiated by a message being received on a JMS queue</p>
</li>
<li>
<p>A SwitchYard Service is called which then invokes a SwitchYard Reference with a web service binding</p>
</li>
<li>
<p>The SwitchYard Reference is currently recorded as a separate Service node</p>
</li>
<li>
<p>HTTP invocation with the matching interaction correlation id, linking this Producer node with the Consumer node in the first business transaction fragment</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Summary</strong></p>
</div>
<div class="paragraph">
<p>These two business transaction fragments show how a business transaction instance can be traced across JMS, Apache Camel, SwitchYard and HTTP (Web Service), with the two fragments being correlated based on an ID shared between the HTTP Producer and Consumer nodes.</p>
</div>
<div class="paragraph">
<p>Feel free to try out the release for yourself on your own applications. If you have any questions or comments, please contact us on <a href="/community/join.html">these channels</a>.</p>
</div>
<div class="paragraph">
<p>If you have suggestions for features/enhancements, or find any bugs, then please log an issue in the <a href="https://issues.jboss.org/browse/HWKBTM">project jira</a>.</p>
</div></p>
    	<hr /><br /><br />

        <p><em>Published by Gary Brown on  01 July 2015</em></p>

    <div id="disqus_thread"></div>
        <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES * * */
        var disqus_shortname = 'hawkular';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>

		</div>
		<div id="push"></div>
    </div>

    <section class="redhat clearfix">
      <div class="container">
        <p class="pull-left">
          <a href="http://www.redhat.com/">
            <img alt="redhatlogo-white" src="../../../..//img/redhatlogo-white.png" width="130">
          </a>
        </p>
        <p class="muted credit pull-right">
				  &copy; 2016 | Hawkular is released under <a href="/license.html">Apache License v2.0</a>
					<a href="https://twitter.com/hawkular_org" class="twitter-follow-button" data-show-count="false" data-size="medium">Follow @hawkular_org</a>
				  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
					<iframe src="https://ghbtns.com/github-btn.html?user=hawkular&repo=hawkular-services&type=star" frameborder="0" scrolling="0" class="github-stars-btn"></iframe>
				</p>

    <!--p id="forkongithubp"><span id="forkongithub">
      <a href="https://github.com/hawkular" class="bg-grey">
        Fork me on GitHub
      </a>
    </span></p-->
      </div>
    </section>

    <!-- javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- js -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="../../../../js/jbossorg-tabzilla.js"></script>
    <script src="../../../../js/behavior.js"></script>
    <script src="../../../../js/prettify.js"></script>
    <script src="../../../../js//ekko-lightbox.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'hawkular';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61728352-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
