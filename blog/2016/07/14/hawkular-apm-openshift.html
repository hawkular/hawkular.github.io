<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Hawkular - Monitoring Application Performance within Openshift</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- css -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link href="../../../../css/tabzilla.css" rel="stylesheet">
    <link href="../../../../css/styles.css" rel="stylesheet">
    <link href="../../../../css/prettify.css" rel="stylesheet">
    <link href="../../../../css/ekko-lightbox.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
    <script src="../../../../js/moment.min.js"></script>
    <script src="../../../../js/jquery-1.11.2.min.js"></script>

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../../favicon.ico">
    
  </head>
  <body onload="prettyPrint()" data-spy="scroll" data-offset="80" data-target="#toc">

	
<!-- Fixed navbar -->
<nav class="navbar navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <a class="navbar-brand" href="../../../..//">Home</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="../../../../blog.html" role="button">Blog</a></li>
        <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
          Community
          <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" role="menu">
            <li class="menu-item">
              <a href="../../../../community/docs/getting-involved/">Getting Involved</a>
            </li>
            <li class="menu-item">
              <a href="../../../../community/docs/developer-guide/">Developer Guide</a>
            </li>
            <li class="menu-item dropdown dropdown-submenu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Labs</a>
                <ul class="dropdown-menu">
                  <li class="menu-item ">
                    <a href="../../../../community/labs/datamining/">Datamining</a>
                  </li>
                  <li class="menu-item ">
                    <a href="https://github.com/pilhuhn/hawkfx">HawkFX</a>
                  </li>
                  <li class="menu-item ">
                    <a href="../../../../hawkular-clients/android-client/">Android client</a>
                  </li>
                  <li class="menu-item ">
                    <a href="https://github.com/jotak/hawkular-java-toolbox">Client-side java toolbox</a>
                  </li>
                </ul>
            </li>
            <li>
              <a href="https://github.com/hawkular">GitHub Repositories</a>
            <li>
              <a href="https://travis-ci.org/hawkular">CI Builds</a>
            </li>
          </ul>
        </li>
      </ul>
      <div id="wrap">
        <div class="dropup">
          <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
          <script>
            window.addEventListener('load', function() {
              renderTabzilla("Hawkular", "https://hawkular.github.io", true );
            }, false);
          </script>
        </div>
      </div>
    </div>
</nav>

    <section class="main-banner blog-mainbanner">
        <div class="container">
            <h1>Monitoring Application Performance within Openshift</h1>
            <p>A blog post by Gary Brown</p>
<!-- show tags for this page -->
   <p> 
      <a href="/tags/apm.html">apm</a> 
          |
      <a href="/tags/application performance.html">application performance</a> 
          |
      <a href="/tags/btm.html">btm</a> 
          |
      <a href="/tags/business transactions.html">business transactions</a> 
          |
      <a href="/tags/cloud.html">cloud</a> 
          |
      <a href="/tags/distributed tracing.html">distributed tracing</a> 
          |
      <a href="/tags/docker.html">docker</a> 
          |
      <a href="/tags/openshift.html">openshift</a> 
  </p>
        </div>
    </section>

    <div class="blog-container">
        <br/><br/>
    	<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This post will show how to use the Hawkular APM project, previously known as Hawkular BTM, to monitor an application running within Openshift. To achieve this both the Hawkular APM server, and the application (a vert.x Javascript example), will be deployed as Docker images.</p>
</div>
<div class="paragraph">
<p>We will use the Openshift CLI, and therefore will need to login. For example, to login into the Openshift CDK environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc login 10.1.2.2:8443 -u openshift-dev -p devel</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_hawkular_apm_server">Deploy Hawkular APM Server</h3>
<div class="paragraph">
<p>The first step is to deploy the Hawkular APM server. There are two ways that this can be achieved.</p>
</div>
<div class="sect3">
<h4 id="_image_from_docker_hub">Image from Docker Hub</h4>
<div class="paragraph">
<p>The Hawkular APM server has a docker image registered at <a href="https://hub.docker.com/r/jboss/hawkular-apm-server">Docker Hub</a>. This can be deployed to Openshift using the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc new-app jboss/hawkular-apm-server
oc expose service hawkular-apm-server</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>new-app</em> command deploys the image as a service, and the <em>expose</em> command makes it available via a stable URI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If the deploy fails with an "unknown manifest" error in the openshift events log, this is due to a <a href="http://lists.openshift.redhat.com/openshift-archives/users/2016-June/msg00054.html">known docker issue related to a change between version 1.9 and 1.10</a>. In this case, use the local deploy approach described below.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_local_image">Local Image</h4>
<div class="paragraph">
<p>To deploy the APM server from a local build, it will be necessary to get the <a href="https://github.com/jboss-dockerfiles/hawkular/blob/8ffb752b68c0f49a2150fe345e660c53c32fb954/hawkular-apm-server/Dockerfile"><em>Dockerfile</em></a>. Place this file in a suitable folder and from that location run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc new-build --binary --name=hawkular-apm-server
oc start-build hawkular-apm-server --from-dir=. --follow
oc new-app hawkular-apm-server
oc expose service hawkular-apm-server</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hawkular_apm_server_in_the_openshift_console">Hawkular APM Server in the Openshift Console</h3>
<div class="paragraph">
<p>Once either of these options has been used to deploy the Hawkular APM Server, it can be seen within the Openshift console.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-07-14-osapmserver.png" alt="Hawkular APM Server">
</div>
<div class="title">Figure 1. Hawkular APM Server deployed in Openshift</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_example_vert_x_javascript_application">Deploy Example Vert.x Javascript Application</h3>
<div class="paragraph">
<p>The application that we will monitor is a Vert.x Javascript example application. Either clone the <a href="https://github.com/vert-x3/vertx-examples">github repository</a> or simply copy the two relevant files from the <a href="https://github.com/vert-x3/vertx-examples/tree/master/docker-examples/vertx-docker-javascript">vertx-examples/docker-examples/vertx-docker-javascript</a> folder.</p>
</div>
<div class="paragraph">
<p>To enable the application to be instrumented by Hawkular APM, it will be necessary to add the following lines in the <em>Dockerfile</em>, before the <em>EXPOSE 8080</em> line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ENV HAWKULAR_APM_VERSION 0.9.0.Final

ADD https://github.com/hawkular/hawkular-apm/releases/download/$HAWKULAR_APM_VERSION/hawkular-apm-agent.jar hawkular-apm-agent.jar

ENV JAVA_OPTS -javaagent:/hawkular-apm-agent.jar</pre>
</div>
</div>
<div class="paragraph">
<p>Then, from the same folder in which these files are located, run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc new-build --binary --name=vertx-javascript
oc start-build vertx-javascript --from-dir=. --follow
oc new-app -e HAWKULAR_APM_URI=http://hawkular-apm-server-sample-project.rhel-cdk.10.1.2.2.xip.io -e HAWKULAR_APM_USERNAME=jdoe -e HAWKULAR_APM_PASSWORD=password vertx-javascript

oc expose service vertx-javascript</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <em>HAWKULAR_APM_URI</em> must use the URI exposed by the Hawkular APM server, as shown in the console image above.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_example_vert_x_javascript_application_in_the_openshift_console">Example Vert.x Javascript Application in the Openshift Console</h3>
<div class="paragraph">
<p>Once these commands have been performed, the Openshift console should also now include:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-07-14-osvertx.png" alt="Vert.x Javascript example">
</div>
<div class="title">Figure 2. Vert.x Javascript example deployed in Openshift</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_example_application">Running the Example Application</h3>
<div class="paragraph">
<p>To access the example Vert.x Javascript application, simply open a browser window at the URL displayed in the console entry for the application (or just select the link which will cause a new tab to be opened). This will cause the simple Javascript application to return a response and show the message "Wild world":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-07-14-osvertxapp.png" alt="Vert.x Javascript example">
</div>
<div class="title">Figure 3. Vert.x Javascript example running within a browser</div>
</div>
<div class="paragraph">
<p>Now if we access the URL associated with the Hawkular APM server, by simply selecting the link in the Openshift console, we will be presented with a login window. Enter the username <em>jdoe</em> and password <em>password</em>, and then you will see some basic information showing the result of executing the Vert.x Javascript application - in this case the application was run multiple times by refreshing the browser page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2016/2016-07-14-osapm.png" alt="APM info">
</div>
<div class="title">Figure 4. Application Performance Management information captured from the example application</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph">
<p>To summarise, this blog has shown:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to monitor an existing application <strong>without requiring any code changes</strong> simply by adding a few lines to the docker configuration file. Even if it is not possible to modify the application&#8217;s <em>Dockerfile</em> (i.e. because it is obtained from Docker Hub), it is still possible to achieve the same result by deriving a new <em>Dockerfile</em> from the image of interest, that contains the additional lines shown in this blog.</p>
</li>
<li>
<p>How to deploy the Hawkular APM Server, along with the monitored application, as <em>Docker</em> images that can be run within Openshift.</p>
</li>
<li>
<p>How to visualise the response time associated with a REST call to a Vert.x Javascript application. In this particular example, a single URL was invoked multiple times - hence only a single entry. However for more complex examples, detailed component information (such as EJBs, Databases, etc) and the dependencies between remotely invoked services, may be shown.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you have any questions please <a href="http://www.hawkular.org/community/index.html">contact us</a>.</p>
</div>
</div></p>
    	<hr /><br /><br />

        <p><em>Published by Gary Brown on  14 July 2016</em></p>

    <div id="disqus_thread"></div>
        <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES * * */
        var disqus_shortname = 'hawkular';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>

		</div>
		<div id="push"></div>
    </div>

    <section class="redhat clearfix">
      <div class="container">
        <p class="pull-left">
          <a href="http://www.redhat.com/">
            <img alt="redhatlogo-white" src="../../../..//img/redhatlogo-white.png" width="130">
          </a>
        </p>
        <p class="muted credit pull-right">
				  &copy; 2016 | Hawkular is released under <a href="/license.html">Apache License v2.0</a>
					<a href="https://twitter.com/hawkular_org" class="twitter-follow-button" data-show-count="false" data-size="medium">Follow @hawkular_org</a>
				  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
					<iframe src="https://ghbtns.com/github-btn.html?user=hawkular&repo=hawkular-services&type=star" frameborder="0" scrolling="0" class="github-stars-btn"></iframe>
				</p>

    <!--p id="forkongithubp"><span id="forkongithub">
      <a href="https://github.com/hawkular" class="bg-grey">
        Fork me on GitHub
      </a>
    </span></p-->
      </div>
    </section>

    <!-- javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- js -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="../../../../js/jbossorg-tabzilla.js"></script>
    <script src="../../../../js/behavior.js"></script>
    <script src="../../../../js/prettify.js"></script>
    <script src="../../../../js//ekko-lightbox.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'hawkular';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61728352-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
