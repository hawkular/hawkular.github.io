<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Hawkular - Collecting Metrics from Prometheus Endpoints</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- css -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link href="../../../../css/tabzilla.css" rel="stylesheet">
    <link href="../../../../css/styles.css" rel="stylesheet">
    <link href="../../../../css/prettify.css" rel="stylesheet">
    <link href="../../../../css/ekko-lightbox.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
    <script src="../../../../js/moment.min.js"></script>
    <script src="../../../../js/jquery-1.11.2.min.js"></script>

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../../favicon.ico">
    
  </head>
  <body onload="prettyPrint()" data-spy="scroll" data-offset="80" data-target="#toc">

	
<!-- Fixed navbar -->
<nav class="navbar navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <a class="navbar-brand" href="../../../..//">Home</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="../../../../blog.html" role="button">Blog</a></li>
        <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
          Community
          <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" role="menu">
            <li class="menu-item">
              <a href="../../../../community/docs/getting-involved/">Getting Involved</a>
            </li>
            <li class="menu-item">
              <a href="../../../../community/docs/developer-guide/">Developer Guide</a>
            </li>
            <li class="menu-item dropdown dropdown-submenu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Labs</a>
                <ul class="dropdown-menu">
                  <li class="menu-item ">
                    <a href="../../../../community/labs/datamining/">Datamining</a>
                  </li>
                  <li class="menu-item ">
                    <a href="https://github.com/pilhuhn/hawkfx">HawkFX</a>
                  </li>
                  <li class="menu-item ">
                    <a href="../../../../hawkular-clients/android-client/">Android client</a>
                  </li>
                  <li class="menu-item ">
                    <a href="https://github.com/jotak/hawkular-java-toolbox">Client-side java toolbox</a>
                  </li>
                </ul>
            </li>
            <li>
              <a href="https://github.com/hawkular">GitHub Repositories</a>
            <li>
              <a href="https://travis-ci.org/hawkular">CI Builds</a>
            </li>
          </ul>
        </li>
      </ul>
      <div id="wrap">
        <div class="dropup">
          <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
          <script>
            window.addEventListener('load', function() {
              renderTabzilla("Hawkular", "https://hawkular.github.io", true );
            }, false);
          </script>
        </div>
      </div>
    </div>
</nav>

    <section class="main-banner blog-mainbanner">
        <div class="container">
            <h1>Collecting Metrics from Prometheus Endpoints</h1>
            <p>A blog post by John Mazzitelli</p>
<!-- show tags for this page -->
   <p> 
      <a href="/tags/agent.html">agent</a> 
          |
      <a href="/tags/hawkular.html">hawkular</a> 
          |
      <a href="/tags/prometheus.html">prometheus</a> 
  </p>
        </div>
    </section>

    <div class="blog-container">
        <br/><br/>
    	<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Hawkular WildFly Agent 0.17.2.Final has just been released. This new release introduces a very interesting feature.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prometheus_metrics">Prometheus Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The agent now has the ability to monitor Prometheus endpoints and store their metrics to Hawkular Metrics. This means any
component that exports Prometheus metric data via either <a href="https://prometheus.io/docs/instrumenting/exposition_formats/">the Prometheus binary or text formats</a> can have those metric data collected by the agent
and pushed up into Hawkular Metrics.</p>
</div>
<div class="sect2">
<h3 id="_configuration">Configuration</h3>
<div class="paragraph">
<p>It is very easy to configure the Hawkular WildFly Agent to collect Prometheus metric data. In the WildFly container
that houses the agent, edit its standalone.xml configuration file and add one or more &lt;remote-prometheus&gt; elements
in the &lt;managed-servers&gt; section of the agent subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;remote-prometheus name="My Remote Prometheus Endpoint"
                   enabled="true"
                   url="http://my-prometheus-endpoint:9090/metrics"
                   interval="30"
                   timeUnits="seconds" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tells the agent to periodically scrape the metric data from that remote Prometheus endpoint and whatever metrics
it finds will be pushed to Hawkular Metrics.</p>
</div>
<div class="paragraph">
<p>In fact, if you only want to collect Prometheus metric data (and not collect any other kind of metric data,
like those from DMR endpoints or Jolokia/JMX endpoints) you need only those &lt;remote-prometheus&gt; declarations. You
do not have to also collect from &lt;remote-dmr&gt; or &lt;remote-jmx&gt; servers (though you are free to do so if you want to monitor
types of those components, too).</p>
</div>
<div class="paragraph">
<p>Some Prometheus endpoints expose a lot of metrics, some of which you may not be interested in collecting and storing. In
this case, you have the option to define metric sets which tell the agent which metrics to collect and store (any others
will be ignored).</p>
</div>
<div class="paragraph">
<p>Here is an example of a full agent subsystem configuration that defines a remote Prometheus endpoint and the metrics
to be collected from that endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:org.hawkular.agent:agent:1.0" enabled="true"&gt;
    &lt;diagnostics enabled="true" interval="1" reportTo="LOG" timeUnits="minutes"/&gt;
    &lt;storage-adapter type="HAWKULAR" serverOutboundSocketBindingRef="hawkular" username="jdoe" password="password"/&gt;

    &lt;metric-set-prometheus name="Important Metrics"&gt;
        &lt;metric-prometheus name="http_.*"/&gt;
        &lt;metric-prometheus name="evaluation_failures_total" /&gt;
    &lt;/metric-set-prometheus&gt;

    &lt;managed-servers&gt;
        &lt;remote-prometheus enabled="true"
                           name="My Remote Prometheus Endpoint"
                           url="http://my-remote-prometheus-endpoint:9090/metrics"
                           metricSets="Important Metrics"
                           interval="30"
                           timeUnits="seconds" /&gt;
    &lt;/managed-servers&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration tells the agent to scrape the given Prometheus endpoint URL every 30 seconds and
store all the metrics with the name "evaluation_failures_total" or with a name that matches
the regular expression "http_.*". Any other metrics exported by that remote Prometheus endpoint will be
ignored.</p>
</div>
<div class="paragraph">
<p>Information about this release can be found on Github here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/hawkular/hawkular-agent/tree/0.17.2.Final" class="bare">https://github.com/hawkular/hawkular-agent/tree/0.17.2.Final</a></p>
</li>
<li>
<p><a href="https://github.com/hawkular/hawkular-agent/releases/tag/0.17.2.Final" class="bare">https://github.com/hawkular/hawkular-agent/releases/tag/0.17.2.Final</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></p>
    	<hr /><br /><br />

        <p><em>Published by John Mazzitelli on  22 April 2016</em></p>

    <div id="disqus_thread"></div>
        <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES * * */
        var disqus_shortname = 'hawkular';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>

		</div>
		<div id="push"></div>
    </div>

    <section class="redhat clearfix">
      <div class="container">
        <p class="pull-left">
          <a href="http://www.redhat.com/">
            <img alt="redhatlogo-white" src="../../../..//img/redhatlogo-white.png" width="130">
          </a>
        </p>
        <p class="muted credit pull-right">
				  &copy; 2016 | Hawkular is released under <a href="/license.html">Apache License v2.0</a>
					<a href="https://twitter.com/hawkular_org" class="twitter-follow-button" data-show-count="false" data-size="medium">Follow @hawkular_org</a>
				  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
					<iframe src="https://ghbtns.com/github-btn.html?user=hawkular&repo=hawkular-services&type=star" frameborder="0" scrolling="0" class="github-stars-btn"></iframe>
				</p>

    <!--p id="forkongithubp"><span id="forkongithub">
      <a href="https://github.com/hawkular" class="bg-grey">
        Fork me on GitHub
      </a>
    </span></p-->
      </div>
    </section>

    <!-- javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- js -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="../../../../js/jbossorg-tabzilla.js"></script>
    <script src="../../../../js/behavior.js"></script>
    <script src="../../../../js/prettify.js"></script>
    <script src="../../../../js//ekko-lightbox.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'hawkular';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61728352-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
