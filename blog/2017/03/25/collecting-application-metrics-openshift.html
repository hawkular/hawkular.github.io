<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Hawkular - Collecting Application Metrics Within OpenShift</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- css -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link href="../../../../css/tabzilla.css" rel="stylesheet">
    <link href="../../../../css/styles.css" rel="stylesheet">
    <link href="../../../../css/prettify.css" rel="stylesheet">
    <link href="../../../../css/ekko-lightbox.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
    <script src="../../../../js/moment.min.js"></script>
    <script src="../../../../js/jquery-1.11.2.min.js"></script>

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../../favicon.ico">
    
  </head>
  <body onload="prettyPrint()" data-spy="scroll" data-offset="80" data-target="#toc">

	
<!-- Fixed navbar -->
<nav class="navbar navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <a class="navbar-brand" href="../../../..//">Home</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="../../../../blog.html" role="button">Blog</a></li>
        <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
          Community
          <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" role="menu">
            <li class="menu-item">
              <a href="../../../../community/docs/getting-involved/">Getting Involved</a>
            </li>
            <li class="menu-item">
              <a href="../../../../community/docs/developer-guide/">Developer Guide</a>
            </li>
            <li class="menu-item dropdown dropdown-submenu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Labs</a>
                <ul class="dropdown-menu">
                  <li class="menu-item ">
                    <a href="../../../../community/labs/datamining/">Datamining</a>
                  </li>
                  <li class="menu-item ">
                    <a href="https://github.com/pilhuhn/hawkfx">HawkFX</a>
                  </li>
                  <li class="menu-item ">
                    <a href="../../../../hawkular-clients/android-client/">Android client</a>
                  </li>
                  <li class="menu-item ">
                    <a href="https://github.com/jotak/hawkular-java-toolbox">Client-side java toolbox</a>
                  </li>
                </ul>
            </li>
            <li>
              <a href="https://github.com/hawkular">GitHub Repositories</a>
            <li>
              <a href="https://travis-ci.org/hawkular">CI Builds</a>
            </li>
          </ul>
        </li>
      </ul>
      <div id="wrap">
        <div class="dropup">
          <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
          <script>
            window.addEventListener('load', function() {
              renderTabzilla("Hawkular", "https://hawkular.github.io", true );
            }, false);
          </script>
        </div>
      </div>
    </div>
</nav>

    <section class="main-banner blog-mainbanner">
        <div class="container">
            <h1>Collecting Application Metrics Within OpenShift</h1>
            <p>A blog post by John Mazzitelli</p>
<!-- show tags for this page -->
   <p> 
      <a href="/tags/agent.html">agent</a> 
          |
      <a href="/tags/hosa.html">hosa</a> 
          |
      <a href="/tags/jolokia.html">jolokia</a> 
          |
      <a href="/tags/metrics.html">metrics</a> 
          |
      <a href="/tags/openshift.html">openshift</a> 
          |
      <a href="/tags/prometheus.html">prometheus</a> 
  </p>
        </div>
    </section>

    <div class="blog-container">
        <br/><br/>
    	<p><div class="sect1">
<h2 id="_introducing_hawkular_openshift_agent">Introducing Hawkular OpenShift Agent</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hawkular supports the collection of application metrics within an OpenShift cluster via the Hawkular OpenShift Agent (HOSA). Metrics are stored in the OpenShift-provided Hawkular-Metrics storage facility providing out-of-box, scalable long term storage of metric data allowing for future analytics of your performance data in additional to graphing recent data within the OpenShift UI Console. Alerting on metric data is also provided via the Hawkular-Alerts component within Hawkular-Metrics.</p>
</div>
<div class="paragraph">
<p>HOSA provides ease-of-use for end customers of OpenShift since once HOSA is deployed in a node, the only thing pod developers need to do to collect and store their metrics as well as display them in the OpenShift console is to publish a configmap declaring what metrics that pod wants collected.</p>
</div>
<div class="paragraph">
<p>HOSA dynamically discovers pods when they are deployed in the node (regardless of what project they are in). HOSA will automatically begin collecting metrics from the discovered pods. Metric collection is opt-in - only those pods that declare a specific config map containing HOSA metric configuration will have their metrics collected by HOSA. This allows pod developers to choose what they want to collect and how often they want them collected.</p>
</div>
<div class="paragraph">
<p>Pods may expose their metric data as either Prometheus endpoints (using either the binary or text formats), Jolokia/JMX endpoints (using Jolokia&#8217;s REST API), or as simple JSON documents (as is how, for example, Go&#8217;s expvar data is exposed).</p>
</div>
<div class="paragraph">
<p>HOSA tags each metric with name/value pairs for easy querying and graphing. In addition to the tags defined specifically by HOSA itself, pod developers can attach their own custom tags to their metrics allowing for further customization of the metadata attached to each metric.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2017/2017-03-25-hosa-on-openshift-node.png" alt="2017 03 25 hosa on openshift node">
</div>
<div class="title">Figure 1: Hawkular OpenShift Agent Monitoring Pods on an OpenShift Node</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2017/2017-03-25-hosa-on-openshift-cluster.png" alt="2017 03 25 hosa on openshift cluster">
</div>
<div class="title">Figure 2: Hawkular OpenShift Agent Monitoring Pods on an OpenShift Cluster</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To install HOSA, you can use the latest release published on <a href="https://hub.docker.com/r/hawkular/hawkular-openshift-agent/tags/">Docker Hub</a>. HOSA can be deployed in your OpenShift node as a daemon set. For example, here is an <a href="https://github.com/hawkular/hawkular-openshift-agent/blob/master/deploy/openshift/hawkular-openshift-agent.yaml">OpenShift YAML template</a> along with its <a href="https://github.com/hawkular/hawkular-openshift-agent/blob/master/deploy/openshift/hawkular-openshift-agent-configmap.yaml">config map configuration</a> which you can use to deploy HOSA.</p>
</div>
<div class="paragraph">
<p>HOSA requires additional roles in order to function - you must have the rights to give HOSA its additional roles. Without these additional roles, HOSA will not operate properly.</p>
</div>
<div class="paragraph">
<p>To deploy HOSA:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>oc create -f <a href="https://github.com/hawkular/hawkular-openshift-agent/blob/master/deploy/openshift/hawkular-openshift-agent-configmap.yaml">deploy/openshift/hawkular-openshift-agent-configmap.yaml</a> -n default</code></p>
</li>
<li>
<p><code>oc process -f <a href="https://github.com/hawkular/hawkular-openshift-agent/blob/master/deploy/openshift/hawkular-openshift-agent.yaml">deploy/openshift/hawkular-openshift-agent.yaml</a> -v IMAGE_VERSION=latest | oc create -n deafult -f -</code></p>
</li>
<li>
<p><code>oc adm policy add-cluster-role-to-user hawkular-openshift-agent system:serviceaccount:default:hawkular-openshift-agent</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Or, if you wish, clone the <a href="https://github.com/hawkular/hawkular-openshift-agent.git">HOSA github repo</a> and run <code>make openshift-deploy</code> and it will run the commands you need to deploy. You first must log into OpenShift via <code>oc login</code> prior to running that <code>make</code> command.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_defining_application_metrics_to_be_collected">Defining Application Metrics To Be Collected</h2>
<div class="sectionbody">
<div class="paragraph">
<p>HOSA is only installed by the OpenShift administrator and only one need be installed per node. Once installed, the only thing for pod developers to do in order for HOSA to begin collecting application metrics (and thus allowing the OpenShift Console to graph their data) is to create a config map that defines the metrics that are to be collected.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In order to declare to HOSA which config map to use, the pod must configure a volume named "hawkular-openshift-agent" which refers to the config map. For more details on this, consult one of the example yamls or see the <a href="https://github.com/hawkular/hawkular-openshift-agent/blob/master/README.adoc#pod-volumes">HOSA README</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A pod may have one or more endpoints exposing one or more metrics. HOSA can collect any number of metrics from any number of endpoints from any number of pods from any number of projects within the node. Note that HOSA is configured to limit the number of metrics any one pod may ask to be collected - this is to avoid a "pod hog" who asks HOSA to collect large amounts of data. HOSA will thus limit the amount of resources any one pod can use for metric storage.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what a pod config map can look like - this tells HOSA to collect all metrics from the pod&#8217;s Prometheus endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>endpoints:
- type: prometheus
  protocol: http
  port: 8181
  path: /metrics
  collection_interval: 30s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s what a pod config map can look like if the pod emits Jolokia/JMX metrics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>endpoints:
- type: jolokia
  protocol: http
  port: 8778
  path: /jolokia/
  collection_interval: 15s
  metrics:
  - name: java.lang:type=OperatingSystem#OpenFileDescriptorCount
    type: gauge
    description: Open File Descriptor Count
  - name: java.lang:type=Memory#HeapMemoryUsage#*
    type: gauge
    description: Heap Memory Used ${2}
    units: B
  - name: jboss.as:subsystem=datasources,data-source=*,statistics=jdbc#*
    type: gauge
    description: Data Source ${data-source} JDBC Statistic ${1}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples">Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several examples published in the HOSA git repo and docker hub to see how different types of metrics can be configured.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A pod deployed with a Python application that emits metrics via a Prometheus endpoint:</p>
<div class="ulist">
<ul>
<li>
<p>Source: <a href="https://github.com/hawkular/hawkular-openshift-agent/tree/master/examples/prometheus-python-example" class="bare">https://github.com/hawkular/hawkular-openshift-agent/tree/master/examples/prometheus-python-example</a></p>
</li>
<li>
<p>Image on Docker Hub: <a href="https://hub.docker.com/r/hawkular/hawkular-openshift-agent-example-prometheus-python" class="bare">https://hub.docker.com/r/hawkular/hawkular-openshift-agent-example-prometheus-python</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>A pod deployed with a WildFly application server that emits metrics via a secured Jolokia/JMX endpoint:</p>
<div class="ulist">
<ul>
<li>
<p>Source: <a href="https://github.com/hawkular/hawkular-openshift-agent/tree/master/examples/jolokia-wildfly-example" class="bare">https://github.com/hawkular/hawkular-openshift-agent/tree/master/examples/jolokia-wildfly-example</a></p>
</li>
<li>
<p>Image on Docker Hub: <a href="https://hub.docker.com/r/hawkular/hawkular-openshift-agent-example-jolokia-wildfly/" class="bare">https://hub.docker.com/r/hawkular/hawkular-openshift-agent-example-jolokia-wildfly/</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>A pod deployed with a Python application that emits metrics over several Prometheus endpoints:</p>
<div class="ulist">
<ul>
<li>
<p>Source: <a href="https://github.com/hawkular/hawkular-openshift-agent/tree/master/examples/multiple-endpoints-example" class="bare">https://github.com/hawkular/hawkular-openshift-agent/tree/master/examples/multiple-endpoints-example</a></p>
</li>
<li>
<p>Image on Docker Hub: <a href="https://hub.docker.com/r/hawkular/hawkular-openshift-agent-example-multiple-endpoints/" class="bare">https://hub.docker.com/r/hawkular/hawkular-openshift-agent-example-multiple-endpoints/</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>A pod deployed with a Go application that emits metrics in a JSON document (using Go&#8217;s expvar feature):</p>
<div class="ulist">
<ul>
<li>
<p>Source: <a href="https://github.com/hawkular/hawkular-openshift-agent/tree/master/examples/go-expvar-example" class="bare">https://github.com/hawkular/hawkular-openshift-agent/tree/master/examples/go-expvar-example</a></p>
</li>
<li>
<p>Image on Docker Hub: <a href="https://hub.docker.com/r/hawkular/hawkular-openshift-agent-example-go-expvar/" class="bare">https://hub.docker.com/r/hawkular/hawkular-openshift-agent-example-go-expvar/</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To see HOSA collect metrics from these example pods, deploy one or more of these in OpenShift. If you git cloned the HOSA git repo, you can use the Makefiles in the example directories to deploy them - within an example directory, run <code>make openshift-deploy</code>.</p>
</div>
<div class="paragraph">
<p>Once HOSA is collecting and storing your application metrics, the OpenShift Console will display graphs of your data in the pod&#8217;s Metrics tab:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/blog/2017/2017-03-25-hosa-os-ui.png" alt="2017 03 25 hosa os ui">
</div>
<div class="title">Figure 3: OpenShift Application Metrics Collected and Stored By Hawkular</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_for_more_details">For More Details</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Take a look at the <a href="https://github.com/hawkular/hawkular-openshift-agent/blob/master/README.adoc">HOSA README file</a> for more details. You may ask questions in the #hawkular chat room on freenode IRC or send an email to the <a href="https://lists.jboss.org/mailman/listinfo/hawkular-dev">hawkular-dev mailing list</a>.</p>
</div>
<div class="paragraph">
<p>You can also check out an earlier blog on this topic - <a href="http://www.hawkular.org/blog/2017/01/17/obst-hosa.html">Monitoring Microservices on Openshift with the Hawkular Openshift Agent</a></p>
</div>
</div>
</div></p>
    	<hr /><br /><br />

        <p><em>Published by John Mazzitelli on  25 March 2017</em></p>

    <div id="disqus_thread"></div>
        <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES * * */
        var disqus_shortname = 'hawkular';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>

		</div>
		<div id="push"></div>
    </div>

    <section class="redhat clearfix">
      <div class="container">
        <p class="pull-left">
          <a href="http://www.redhat.com/">
            <img alt="redhatlogo-white" src="../../../..//img/redhatlogo-white.png" width="130">
          </a>
        </p>
        <p class="muted credit pull-right">
				  &copy; 2016 | Hawkular is released under <a href="/license.html">Apache License v2.0</a>
					<a href="https://twitter.com/hawkular_org" class="twitter-follow-button" data-show-count="false" data-size="medium">Follow @hawkular_org</a>
				  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
					<iframe src="https://ghbtns.com/github-btn.html?user=hawkular&repo=hawkular-services&type=star" frameborder="0" scrolling="0" class="github-stars-btn"></iframe>
				</p>

    <!--p id="forkongithubp"><span id="forkongithub">
      <a href="https://github.com/hawkular" class="bg-grey">
        Fork me on GitHub
      </a>
    </span></p-->
      </div>
    </section>

    <!-- javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- js -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="../../../../js/jbossorg-tabzilla.js"></script>
    <script src="../../../../js/behavior.js"></script>
    <script src="../../../../js/prettify.js"></script>
    <script src="../../../../js//ekko-lightbox.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'hawkular';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61728352-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
