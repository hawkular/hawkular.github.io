<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Hawkular - Keycloak integration</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- css -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/tabzilla.css" rel="stylesheet">
    <link href="../../css/styles.css" rel="stylesheet">
    <link href="../../css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
    <script src="../../js/moment.min.js"></script>
    <script src="../../js/jquery-1.11.2.min.js"></script>

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../favicon.ico">
    
  </head>
  <body onload="prettyPrint()" data-spy="scroll" data-offset="80" data-target="#toc">
    <div id="wrap">
      <div class="dropup">
        <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
        <script>
            window.addEventListener('load', function() {
                 renderTabzilla("Hawkular", "https://hawkular.github.io", true );
            }, false);
        </script>
      </div>

	<!-- Fixed navbar -->
    <nav class="navbar navbar-fixed-top" role="navigation">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button class="navbar-toggle collapsed" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">Home</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li><a href="../../index.html">Hawkular</a></li>
            <li>
              <a href="../../docs/user/getting-started.html">Getting
                  Started</a>
            </li>
            <li class=""><a href="../../downloads.html">Downloads</a></li>
            <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
              Documentation
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" role="menu">
              <li>
                <a href="../../docs/user/getting-started.html">User Documentation</a>
              </li>
              <li>
                <a href="../../docs/dev/development.html">Developer Documentation</a>
              </li>
              <li>
                <a href="../../docs/dev/terms.html">Used Terms</a>
              </li>
              <li class="menu-item dropdown dropdown-submenu">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">REST API</a>
                <ul class="dropdown-menu">
                  <li class="menu-item ">
                    <a href="../../docs/rest/rest-alerts.html">Alerts</a>
                  </li>
                  <li class="menu-item ">
                    <a href="../../docs/rest/rest-btm.html">Business Transaction Management</a>
                  </li>
                  <li class="menu-item ">
                    <a href="../../docs/rest/rest-inventory.html">Inventory</a>
                  </li>
                  <li class="menu-item ">
                    <a href="../../docs/rest/rest-metrics.html">Metrics</a>
                  </li>
                </ul>
              </li>
              <li class="menu-item dropdown dropdown-submenu">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Sub-projects</a>
                <ul class="dropdown-menu">
                  <li class="menu-item ">
                    <a href="../../docs/components/metrics/index.html">Metrics</a>
                  </li>
                  <li class="menu-item ">
                    <a href="../../docs/components/btm/index.html">Business Transaction Management</a>
                  </li>
                </ul>
              </li>
            </ul>
            <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
              Community
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" role="menu">
              <li>
                <a href="../../community/index.html">Home</a>
              </li>
              <li>
                <a href="../../community/join.html">Join</a>
              </li>
              <li>
                <a href="../../license.html">License</a>
              </li>
              <li>
                <a href="https://travis-ci.org/hawkular">CI Builds</a>
              </li>
            </ul></li>
            <li class=""><a href="../../blog.html">Blog</a></li>
          </ul>
        </div>
      </div>
    </nav>

      <section class="main-banner">
        <div class="container">
          <h1>Keycloak integration</h1>
          <p>How Keycloak is integrated with Hawkular</p>
        </div>
      </section>

	<!--<p><em>26 June 2015</em></p>-->

	<section>
      <div class="container">
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_hawkular_accounts">Hawkular Accounts</a></li>
<li><a href="#_master_password">Master password</a></li>
<li><a href="#_hawkular_realm">Hawkular realm</a></li>
<li><a href="#_event_listeners">Event Listeners</a>
<ul class="sectlevel2">
<li><a href="#_event_publisher_jms">Event publisher - JMS</a></li>
<li><a href="#_event_publisher_rest">Event publisher - REST</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://keycloak.org">Keycloak</a> is an SSO solution for web apps, mobile and RESTful web services. Hawkular bundles its
own Keycloak server instance, pre-configured with a realm, UI theme and event listeners. From the very beginning,
this integration has been thought of as a key part of authentication for Hawkular, without leaving out the fact that
Keycloak would possibly already exist in some environments, so, Hawkular allows Keycloak to be on an external Wildfly
instance. This document outlines all aspects of Hawkular&#8217;s integration with Keycloak.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hawkular_accounts">Hawkular Accounts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The integration between Keycloak and Hawkular is done via the component Hawkular Accounts. This component is
responsible for managing the personas, organizations and other Hawkular particularities. Hawkular Accounts should
always live with the main Hawkular instance, while Keycloak might be
<a href="external-keycloak.html">deployed on an external server</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_master_password">Master password</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although Hawkular itself doesn&#8217;t have a "super admin" or "root" user, Keycloak ships with one. To be consistent with
the official Keycloak distribution, the admin account is unchanged. In other words: once you have your Hawkular
server available in a public server, the admin&#8217;s password should be changed.</p>
</div>
<div class="paragraph">
<p>To do so, simply access <a href="http://&lt;your-hawkular-instance&gt;:8080/auth/admin" class="bare">http://&lt;your-hawkular-instance&gt;:8080/auth/admin</a> , login as "admin" with the password "admin".
After that, Keycloak will request a password change for this user.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hawkular_realm">Hawkular realm</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hawkular ships with a Keycloak realm under <code>$WILDFLY_HOME/standalone/configuration/hawkular-realm.json</code>. On developer
builds, the realm template <code>$WILDFLY_HOME/standalone/configuration/hawkular-realm-for-dev.json</code> is used instead. To
control which realm is imported, the system property <code>keycloak.import</code> can be tweaked, either via <code>-D</code> when booting
Wildfly or by changing it on the <code>$WILDFLY_HOME/standalone/configuration/standalone.xml</code>. Note, however, that this
import happens only during the first boot, as Keycloak won&#8217;t import a realm that exists already. If changes are
required for the realm on an existing Hawkular instance, it should be done via the Keycloak admin interface.</p>
</div>
<div class="paragraph">
<p>The two template realm files should be identical in features, except for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The production build has a strict password policy, which matches the password policy for Wildfly.</p>
</li>
<li>
<p>The developer build has a pre-registered user, with the login "jdoe" and password "password".</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_event_listeners">Event Listeners</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Keycloak allows the installation event listeners, so that applications can be notified when something of interest
happens regarding user or admin activities. Hawkular uses this feature to get notified when some events are
triggered and ships with two event listeners for Keycloak. As the role of those publishers is mainly to re-publish the
events to Hawkular, only one of the listeners should be <strong>active</strong> at any given point in time, even though both are
deployed and available by default.</p>
</div>
<div class="paragraph">
<p>To switch listeners, login to Keycloak&#8217;s admin interface, select the realm 'Hawkular' and add/remove the listener via
the "Events" / "Configuration" screen:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/img/docs/event-configuration-keycloak.png" alt="Event configuration at Keycloak">
</div>
</div>
<div class="paragraph">
<p>For automated deployments, this can be changed before the first boot on the realm template file
<code>$WILDFLY_HOME/standalone/configuration/hawkular-realm.json</code>, under the <code>eventsListeners</code> entry:</p>
</div>
<div class="paragraph">
<p><code>hawkular-realm.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-json" data-lang="json">{
  "id" : "hawkular-realm",
  "realm" : "hawkular",
  "enabled" : true,
  ...
  "eventsListeners" : [ "hawkular-jms", "jboss-logging" ],
  ...
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_event_publisher_jms">Event publisher - JMS</h3>
<div class="paragraph">
<p>This event listener receives the events from Keycloak and publishes them to Hawkular via JMS. This is the default
event listener and should be used when Keycloak and Hawkular are running on the same Wildfly instance. The name on
the configuration for this listener is "hawkular-jms".</p>
</div>
</div>
<div class="sect2">
<h3 id="_event_publisher_rest">Event publisher - REST</h3>
<div class="paragraph">
<p>This event listener receives the events from Keycloak and publishes them to Hawkular via the REST endpoint
<code><a href="http://&lt;hawkular-server-instance&gt;:8080/hawkular-accounts-events-backend/events" class="bare">http://&lt;hawkular-server-instance&gt;:8080/hawkular-accounts-events-backend/events</a></code>. The actual URL for the endpoint should
be configured on the <code>standalone.xml</code> from the Keycloak server via the system property
<code>hawkular.events.listener.rest.endpoint</code>. The name on the configuration for this listener is "hawkular-rest".</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This endpoint is <strong>not</strong> protected. Make sure to properly secure it via Wildfly or, if available, an HTTP
server that runs in front of it. Ideally, only the Keycloak server should have access to this endpoint.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
      </div>
    </section>

		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
          <a href="http://www.ej-technologies.com/products/jprofiler/overview.html">Built using JProfiler Java profiler
              <br/>
            <img src="http://www.ej-technologies.com/images/product_banners/jprofiler_small.png" alt="JProfiler logo"/>
           </a>
      </div>
    </div>

    <section class="redhat">
      <div class="container">
        <p class="text-center">
          <a href="http://www.redhat.com/">
            <img alt="redhatlogo-white" src="../..//img/redhatlogo-white.png" width="130">
          </a>
        </p>
        <p class="muted credit">&copy; 2015 | Baked with <a href="http://jbake.org">JBake v2.4.0</a></p>
    <p id="forkongithubp"><span id="forkongithub">
      <a href="https://github.com/hawkular" class="bg-grey">
        Fork me on GitHub
      </a>
    </span></p>
      </div>
    </section>

    <!-- javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- js -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="../../js/jbossorg-tabzilla.js"></script>
    <script src="../../js/behavior.js"></script>
    <script src="../../js/prettify.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'hawkular';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61728352-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
