<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Hawkular - Hawkular Alerting for Developers</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- css -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="../../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link href="../../../css/tabzilla.css" rel="stylesheet">
    <link href="../../../css/styles.css" rel="stylesheet">
    <link href="../../../css/prettify.css" rel="stylesheet">
    <link href="../../../css/ekko-lightbox.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
    <script src="../../../js/moment.min.js"></script>
    <script src="../../../js/jquery-1.11.2.min.js"></script>

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../favicon.ico">
    
  </head>
  <body onload="prettyPrint()" data-spy="scroll" data-offset="80" data-target="#toc">
    <div id="wrap">
      <div class="dropup">
        <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
        <script>
            window.addEventListener('load', function() {
                 renderTabzilla("Hawkular", "https://hawkular.github.io", true );
            }, false);
        </script>
      </div>

    	<!-- Fixed navbar -->
        <nav class="navbar navbar-fixed-top" role="navigation">
          <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button class="navbar-toggle collapsed" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../../">Home</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav">
                <li><a href="../../../overview/">Overview</a></li>
                <li><a href="../../../blog.html">Blog</a></li>
                <li class="dropdown">
                  <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                    Hawkular Services<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li class="menu-item dropdown dropdown-submenu">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation</a>
                      <ul class="dropdown-menu">
                        <li class="menu-item ">
                          <a href="../../../hawkular-services/docs/quickstart-guide/">Quickstart</a>
                        </li>
                        <li class="menu-item ">
                          <a href="../../../hawkular-services/docs/installation-guide/">Installation Guide</a>
                        </li>
                        <li class="menu-item ">
                          <a href="../../../hawkular-services/docs/user-guide/">User Guide</a>
                        </li>
                        <li class="menu-item dropdown dropdown-submenu">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">REST API</a>
                          <ul class="dropdown-menu">
                            <li class="menu-item ">
                              <a href="../../../docs/rest/rest-alerts.html">Alerting</a>
                            </li>
                            <li class="menu-item ">
                              <a href="../../../docs/rest/rest-inventory.html">Inventory</a>
                            </li>
                            <li class="menu-item ">
                              <a href="../../../docs/rest/rest-metrics.html">Metrics</a>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a href="https://github.com/hawkular/hawkular-services/releases">Download</a>
                    </li>
                  </ul>
                </li>
                <li class="dropdown">
                  <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                    Hawkular APM<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li>
                      <li><a href="../../../hawkular-apm/">Overview</a></li>
                    </li>
                    <li>
                      <a href="https://hawkular.gitbooks.io/hawkular-apm-user-guide/content/">Documentation</a>
                    </li>
                    <li>
                      <a href="https://github.com/hawkular/hawkular-apm/releases/">Download</a>
                    </li>
                  </ul>
                </li>
                <li class="dropdown">
                  <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                    Hawkular Metrics<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                  <li class="menu-item dropdown dropdown-submenu">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation</a>
                      <ul class="dropdown-menu">
                        <li class="menu-item ">
                          <a href="../../../hawkular-metrics/docs/user-guide/">Metrics User Guide</a>
                        </li>
                        <li class="menu-item ">
                            <a href="../../../community/docs/developer-guide/alerts-v1.html">Alerting User Guide</a>
                        </li>
                        <li class="menu-item ">
                          <a href="../../../docs/rest/rest-metrics.html">Metrics REST API</a>
                        </li>
                        <li class="menu-item ">
                          <a href="../../../docs/rest/rest-alerts-v1.html">Alerting REST API</a>
                        </li>
                      </ul>
                  </li>
                    <li>
                      <a href="https://github.com/hawkular/hawkular-metrics/releases/">Download</a>
                    </li>
                  </ul>
                </li>
                <li class="dropdown">
                  <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                    Hawkular Alerting<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                  <li class="menu-item dropdown dropdown-submenu">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation</a>
                      <ul class="dropdown-menu">
                        <li class="menu-item dropdown dropdown-submenu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Alerting User Guide</a>
                            <ul class="dropdown-menu">
                              <li class="menu-item ">
                                <a href="../../../community/docs/developer-guide/alerts-v1.html">Version 1</a>
                              </li>
                              <li class="menu-item ">
                                <a href="../../../community/docs/developer-guide/alerts-v2.html">Version 2</a>
                              </li>
                            </ul>
                        </li>
                        <li class="menu-item dropdown dropdown-submenu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Alerting REST API</a>
                            <ul class="dropdown-menu">
                              <li class="menu-item ">
                                <a href="../../../docs/rest/rest-alerts-v1.html">Version 1</a>
                              </li>
                              <li class="menu-item ">
                                <a href="../../../docs/rest/rest-alerts-v2.html">Version 2</a>
                              </li>
                            </ul>
                        </li>
                      </ul>
                  </li>
                    <li>
                      <a href="https://github.com/hawkular/hawkular-alerts/releases/">Download</a>
                    </li>
                  </ul>
                </li>
                <li><a href="../../../hawkular-clients/">Hawkular Clients</a></li>
                <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                  Community
                  <span class="caret"></span>
                </a>
                <ul class="dropdown-menu" role="menu">
                  <li>
                    <a href="../../../community/docs/getting-involved/">Getting Involved</a>
                  </li>
                  <li class="menu-item ">
                    <a href="../../../community/docs/developer-guide/">Developer Guide</a>
                  </li>
                  <li class="menu-item dropdown dropdown-submenu">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Labs</a>
                      <ul class="dropdown-menu">
                        <li class="menu-item ">
                          <a href="../../../community/labs/datamining/">Datamining</a>
                        </li>
                        <li class="menu-item ">
                          <a href="https://github.com/pilhuhn/hawkfx">HawkFX</a>
                        </li>
                        <li class="menu-item ">
                          <a href="../../../hawkular-clients/android-client/">Android client</a>
                        </li>
                        <li class="menu-item ">
                          <a href="https://github.com/jotak/hawkular-java-toolbox">Client-side java toolbox</a>
                        </li>
                      </ul>
                  </li>
                  <li>
                    <a href="https://github.com/hawkular">GitHub Repositories</a>
                  <li>
                    <a href="https://travis-ci.org/hawkular">CI Builds</a>
                  </li>
                </ul></li>
              </ul>
            </div>
          </div>
        </nav>

      <section class="main-banner">
        <div class="container">
          <h1>Hawkular Alerting for Developers</h1>
          <p>Hawkular Alerting Developer Guide - Version 2</p>
<!-- show tags for this page -->
   <p> 
      <a href="/tags/alerts.html">alerts</a> 
  </p>
        </div>

      </section>

	<!--<p><em>24 April 2015</em></p>-->

	<section>
      <div class="container">
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_alerting_philosophy">Alerting Philosophy</a></li>
</ul>
</li>
<li><a href="#_triggers">Triggers</a>
<ul class="sectlevel2">
<li><a href="#_conditions">Conditions</a></li>
<li><a href="#_actions">Actions</a></li>
<li><a href="#_trigger_dampening">Trigger Dampening</a></li>
<li><a href="#_autodisable">AutoDisable</a></li>
<li><a href="#_autoenable">AutoEnable</a></li>
<li><a href="#_source">Source</a></li>
</ul>
</li>
<li><a href="#_group_triggers">Group Triggers</a>
<ul class="sectlevel2">
<li><a href="#_managing_dataids">Managing DataIds</a></li>
<li><a href="#_orphans">Orphans</a></li>
<li><a href="#_data_driven_group_triggers">Data-Driven Group Triggers</a></li>
</ul>
</li>
<li><a href="#_alert_lifecycle">Alert Lifecycle</a>
<ul class="sectlevel2">
<li><a href="#_autoresolve">AutoResolve</a></li>
</ul>
</li>
<li><a href="#_tags">Tags</a>
<ul class="sectlevel2">
<li><a href="#_tags_query_language">Tags Query Language</a></li>
</ul>
</li>
<li><a href="#_external_alert_integration">External Alert Integration</a>
<ul class="sectlevel2">
<li><a href="#_external_conditions">External Conditions</a></li>
</ul>
</li>
<li><a href="#_action_plugins">Action Plugins</a>
<ul class="sectlevel2">
<li><a href="#_create_a_new_plugin">Create a new plugin</a></li>
<li><a href="#_actionpluginlistener_interface">ActionPluginListener interface</a></li>
<li><a href="#_actionmessage_interface">ActionMessage interface</a></li>
</ul>
</li>
<li><a href="#_engine_extensions">Engine Extensions</a>
<ul class="sectlevel2">
<li><a href="#_dataextension_interface">DataExtension interface</a></li>
<li><a href="#_eventextension_interface">EventExtension interface</a></li>
</ul>
</li>
<li><a href="#_events_aggregation_extension">Events Aggregation Extension</a>
<ul class="sectlevel2">
<li><a href="#_events_aggregation_expressions">Events Aggregation Expressions</a></li>
</ul>
</li>
<li><a href="#_elasticsearch_integration">Elasticsearch Integration</a>
<ul class="sectlevel2">
<li><a href="#_elasticsearch_alerter">Elasticsearch Alerter</a></li>
<li><a href="#_elasticsearch_action_plugin">Elasticsearch Action Plugin</a></li>
<li><a href="#_elasticsearch_security">Elasticsearch Security</a></li>
</ul>
</li>
<li><a href="#_rest_api">REST API</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using Hawkular Alerting 1.x?  See the Version 1 Developer Guide <a href="alerts-v1.html">here</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hawkular Alerting is a component of the <a href="http://hawkular.org">Hawkular</a> management and monitoring project. It&#8217;s goal is to provide flexible and scalable alerting services in an easily consumable way.</p>
</div>
<div class="paragraph">
<p>The Hawkular Alerting project lives on <a href="http://github.com/hawkular/hawkular-alerts">GitHub</a>.</p>
</div>
<div class="sect2">
<h3 id="_alerting_philosophy">Alerting Philosophy</h3>
<div class="paragraph">
<p>Alerting is useful, necessary, and typically an integral part of operational sanity.  Done well it strikes the perfect balance between human intervention and automation.  Done poorly it is an ineffective nuisance.  Hawkular Alerting tries to provide the tools to do things well, but it can just as easily be abused.  Alerts bring attention to a problem, or developing problem.  That problem typically requires human intervention to resolve.  As best as possible the alert should represent high level symptoms that affect a user experience.  The number of generated alerts should be small because a human can only respond to a few situations daily.  The same alert should likely not be repeated, or repeated only if a response has not been initiated.</p>
</div>
<div class="sect3">
<h4 id="_alerts">Alerts</h4>
<div class="paragraph">
<p>Alerts are generated when an Alert Trigger fires, based on a set of defined conditions that have been matched, possibly more than once or have held true over a period of time. When fired the trigger can perform actions, typically but not limited to notifications (e-mail, sms, etc). Alerts then start moving through the Open, Acknowledged, Resolved life-cycle.  There are many options on triggers to help ensure that alerts are not generated too frequently, including ways of automatically disabling and enabling the trigger.</p>
</div>
</div>
<div class="sect3">
<h4 id="_events">Events</h4>
<div class="paragraph">
<p>As discussed above the number of alerts should be small in order to be manageable.  But it can be useful to capture interesting happenings in the monitored world. This is called an Event in Hawkular Alerting.  An event can be roughly thought of as an alert without lifecycle.  Like alerts, an event can be generated by a trigger but unlike an alert, it can also be injected directly via the API, so it is very easy for clients to insert events as desired.  And although trigger-generated events can define actions to be performed, in general an event does not need human intervention.  Instead, it is typically something that can contribute to an alert firing, help investigate an alert, or simply help understand system behavior.</p>
</div>
<div class="paragraph">
<p>It is expected that the number of Events can be very large compared to the number of Alerts. Events (like Alerts), can be flexibly queried.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_triggers">Triggers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Trigger defines the conditions that when satisfied will cause the trigger to fire an Alert.  Triggers can have one or more conditions and can optionally fire when ANY or ALL of the conditions are met. A trigger can generate an Alert or an Event.</p>
</div>
<div class="sect2">
<h3 id="_conditions">Conditions</h3>
<div class="paragraph">
<p>There are several different kinds of conditions but they all have one thing in common, each requires some piece of data against which the condition is evaluated.  Here are the different kinds of conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Availability</p>
<div class="ulist">
<ul>
<li>
<p>X is DOWN</p>
</li>
</ul>
</div>
</li>
<li>
<p>Compare</p>
<div class="ulist">
<ul>
<li>
<p>X &lt; 80% Y</p>
</li>
</ul>
</div>
</li>
<li>
<p>Event</p>
<div class="ulist">
<ul>
<li>
<p>event.id starts 'IDXYZ', event.tag.category == 'Server',
event.tag.from ends '.com'</p>
</li>
</ul>
</div>
</li>
<li>
<p>Missing</p>
<div class="ulist">
<ul>
<li>
<p>No event/data received for X in the last 5 minutes</p>
</li>
</ul>
</div>
</li>
<li>
<p>Nelson</p>
<div class="ulist">
<ul>
<li>
<p>Detect Rule1,Rule2 scenarios for X</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Nelson_rules" class="bare">https://en.wikipedia.org/wiki/Nelson_rules</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Rate</p>
<div class="ulist">
<ul>
<li>
<p>X &gt; 10 per-minute</p>
</li>
</ul>
</div>
</li>
<li>
<p>String</p>
<div class="ulist">
<ul>
<li>
<p>X starts with "ABC", X matches "A.*B"</p>
</li>
</ul>
</div>
</li>
<li>
<p>Threshold</p>
<div class="ulist">
<ul>
<li>
<p>X &lt; 10, X &gt;= 20</p>
</li>
</ul>
</div>
</li>
<li>
<p>ThresholdRange</p>
<div class="ulist">
<ul>
<li>
<p>X inside [10,20), X outside [100,200]</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Most conditions deal with numeric data.  But String and Availability data is also supported.  A trigger can combine conditions dealing with data of different types and from different sources.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actions">Actions</h3>
<div class="paragraph">
<p>The whole purpose of alerting is to be able to immediately respond to a developing or active problem.  Hawkular Alerting provides several plugins to take action when alerts are generated.  Custom action plugins can be defined as well. The list of provided action plugins keeps growing, Here is a sample:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>E-mail notification</p>
</li>
<li>
<p>SMS notification</p>
</li>
<li>
<p>SNMP notification</p>
</li>
<li>
<p>Pager Duty integration</p>
</li>
<li>
<p>Aerogear integration</p>
</li>
<li>
<p>File-system notification</p>
</li>
<li>
<p>Webhook notification</p>
</li>
<li>
<p>Elasticsearch integration</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_trigger_dampening">Trigger Dampening</h3>
<div class="paragraph">
<p>It&#8217;s often the case that you don&#8217;t want a trigger to fire every time a condition set is met.  Instead, you want to ensure that the issue is not a spike of activity, or that you don&#8217;t flood an on-call engineer with alerts.  Hawkular Alerting provides several way of ensuring triggers fire only as desired. We call this "<em>Trigger Dampening</em>".  An example is useful for understanding dampening.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say we have a trigger with a single condition: responseTime &gt; 1s.</p>
</div>
<div class="paragraph">
<p>It is important to understand how the reporting interval plays into alerting, and into dampening.  Assume responseTime is reported every 15s.  That means we get roughly 4 data points every minute, and therefore evaluate the condition around 4 times a minute.</p>
</div>
<div class="paragraph">
<p>Here are the different trigger dampening types:</p>
</div>
<div class="sect3">
<h4 id="_strict">Strict</h4>
<div class="ulist">
<ul>
<li>
<p>N consecutive true evaluations</p>
</li>
<li>
<p>Useful for ignoring spikes in activity or waiting for a prolonged event</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our example this could be, "Fire the trigger only if responseTime &gt; 1s for 6 consecutive evaluations".  So, given a 15s reporting interval this means response time would likely have been high for about 90s.  But note that if the reporting interval changes the firing time will change.  This is used more when the number of evaluations is more important than the time it takes to fire.</p>
</div>
<div class="paragraph">
<p>Note that default dampening for triggers is Strict(1).  Which just means that by default a trigger fires every time it&#8217;s condition set evaluates to true.</p>
</div>
</div>
<div class="sect3">
<h4 id="_relaxed_count">Relaxed Count</h4>
<div class="ulist">
<ul>
<li>
<p>N true evaluations out of M total evaluations</p>
</li>
<li>
<p>Useful for ignoring short spikes in activity but catching frequently spiking activity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our example this could be, "Fire the trigger only if responseTime &gt; 1s for 4 of 8 evaluations".  This means the trigger will fire if roughly half the time we are exceeding a 1s response time.  Given a 15s reporting interval this means the trigger could fire in 1 to 2 minutes of accumulated evaluations. But note that if the reporting interval changes the firing time will change.  This is used more when the number of evaluations is more important than the time it takes to fire.</p>
</div>
</div>
<div class="sect3">
<h4 id="_relaxed_time">Relaxed Time</h4>
<div class="ulist">
<ul>
<li>
<p>N true evaluations in T time</p>
</li>
<li>
<p>Useful for ignoring short spikes in activity but catching frequently spiking activity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our example this could be, "Fire the trigger only if responseTime &gt; 1s 4 times in 5 minutes".  This means the trigger will fire if we exceed 1s response time multiple times in a 5 minute period. Given a 15s reporting interval this means the trigger could fire in 1 to 5 minutes of accumulated evaluations. But note that if the reporting interval changes the firing time will change. And also note that the trigger will never fire if we don&#8217;t receive at least 4 reports in the specified 5 minute period. This is used when you don&#8217;t want to exceed a certain period of time before firing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_strict_time">Strict Time</h4>
<div class="ulist">
<ul>
<li>
<p>Only true evaluations for at least T time</p>
</li>
<li>
<p>Useful for reporting a continued aberration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our example this could be, "Fire the trigger only if responseTime &gt; 1s for at least 5 minutes".  This means the trigger will fire if we exceed 1s response time on every report for a 5 minute period. Given a 15s reporting interval this means the trigger will fire after roughly 20 consecutive true evaluations. Note that if the reporting interval changes the firing time will remain roughly the same.  It is important to understand that at least 2 evaluations are required.  The first true evaluation starts the clock. Any false evaluation stops the clock. Assuming only true evaluations, the trigger fires on the first true evaluation at or after the specified period.  The shorter the reporting interval the closer the firing time will be to the specified period, T.</p>
</div>
</div>
<div class="sect3">
<h4 id="_strict_timeout">Strict Timeout</h4>
<div class="ulist">
<ul>
<li>
<p>Only true evaluations for T time</p>
</li>
<li>
<p>Useful for reporting a continued aberration with a more guaranteed firing time</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our example this could be, "Fire the trigger only if responseTime &gt; 1s for 5 minutes".  This means the trigger will fire if we exceed 1s response time on every report for a 5 minute period. Given a 15s reporting interval this means the trigger will fire after roughly 20 consecutive true evaluations. Note that if the reporting interval changes the firing time will remain the same.  It is important to understand that only 1 evaluation is required.  The first true evaluation starts the clock. Assuming only true evaluations, the trigger fires at T, when a timer expires and fires the trigger. Any false evaluation stops the clock and cancels the timer. This type of dampening has more processing overhead because the trigger evaluation requires an external timer.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_autodisable">AutoDisable</h3>
<div class="paragraph">
<p>A trigger can be set for AutoDisable.  Whereas dampening can limit the firing rate of a trigger, disabling a trigger completely stops the trigger from firing (or being evaluated).  A trigger can be manually enabled and disabled, via the REST API, but it can also be disabled automatically. If the trigger has the autoDisable option set to true then after it fires it id disabled, preventing any subsequent alerts until manually re-enabled.  The default is false.</p>
</div>
</div>
<div class="sect2">
<h3 id="_autoenable">AutoEnable</h3>
<div class="paragraph">
<p>A trigger can be set for AutoEnable.  If AutoEnable is true then when an alert is resolved, and if all alerts for the trigger are then resolved, the trigger will be enabled if it is currently disabled.  This ensures that the trigger will again go into firing mode, without needing to be manually enabled by the user. The default is false.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source">Source</h3>
<div class="paragraph">
<p>By default both Triggers and Data ignore "source".  This means that the dataIds defined on a trigger&#8217;s conditions are matched against the dataIds on incoming data (within a tenant) and matching data is evaluated against the conditions.  It is possible to qualify triggers and data with a "source" such that a trigger only evaluates data having the same source.</p>
</div>
<div class="paragraph">
<p>This mechanism is used automatically by <a href="#_data_driven_group_triggers">Data-Driven Group Triggers</a> but can be used manually as well.  If you find that data is better described using a combination source+id, as opposed to just id, then this approach may be appropriate.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_group_triggers">Group Triggers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s often the case that the same alerting needs to be applied to all instances of the same thing.  For example, it may be useful to alert on "System Load &gt; 80%" on 50 different CPUs.  It can be cumbersome to manage 50 individual triggers.</p>
</div>
<div class="paragraph">
<p>A Group Trigger allows you to define a single trigger and then apply it to a group of logically similar things.  A group trigger could be used in the example above.  Then, a member could be added for each CPU.  The member triggers are basically managed copies of the group trigger.  Changes at the group level are pushed down to the members. So, to change "80%" to "85%", or to change autoDisable from false to true, only the group trigger must be changed.</p>
</div>
<div class="sect2">
<h3 id="_managing_dataids">Managing DataIds</h3>
<div class="paragraph">
<p>The group trigger is basically a template, it is not deployed.  Only the member triggers are deployed and actively evaluated because only the member triggers are associated with real dataIds on the conditions.  The group trigger uses "tokens" for the dataIds and each member, when defined, must provide a map of dataId token replacements.</p>
</div>
<div class="paragraph">
<p>Using the example above, our group trigger would define a condition using a dataId token, like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">{ type: "threshold",
  dataId: "SystemLoad",
  operator: "GT"
  threshold: "80.0"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When adding a member for a specific CPU, say CPU-1, we&#8217;d map the token to the real dataId, something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">dataIdMap: {
  "SystemLoad":"CPU-1_SystemLoad"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where "CPU-1_SystemLoad" reflects the actual id associated with system load data sent to alerts for CPU-1.</p>
</div>
<div class="paragraph">
<p>When updating conditions at the group level it is necessary to supply dataId mappings for all of the existing members because the dataIds may have changed on the new condition set.</p>
</div>
</div>
<div class="sect2">
<h3 id="_orphans">Orphans</h3>
<div class="paragraph">
<p>There are times when a particular group member may need to managed individually.  For example, if a single CPU is of particular concern it may be useful to change the threshold level on just that member.  It is possible to orphan a member trigger and manage it independently, while maintaining it&#8217;s association with the group trigger.  It can be unorphaned at any time, and reset to the group settings.</p>
</div>
</div>
<div class="sect2">
<h3 id="_data_driven_group_triggers">Data-Driven Group Triggers</h3>
<div class="paragraph">
<p>Group triggers allow a common definition to be applied to logically similar members. For example, a group trigger could be defined for alerting on CPU SystemLoad and a member trigger would be added for every CPU, each a copy of the group trigger but working against the proper dataId(s) given the CPU instance. When a member is added a map from the group&#8217;s [token] dataIds to the members [real] dataIds must be provided. And if updating conditions at the group level a map for each existing member must be provided. This makes sense, and is fine, but it can be tedious, or difficult to supply.</p>
</div>
<div class="paragraph">
<p>It&#8217;s not uncommon for the member-level dataIds to be a concatenation of id of the source member (e.g. a resourceId, CPU-1, etc) and the group level dataId token (SystemLoad). So you end up with member-level ids like 'CPU-1_SystemLoad' where the "source" is 'CPU-1' and the dataId is 'SystemLoad'.</p>
</div>
<div class="paragraph">
<p>Data-Driven Group Triggers are able to add member triggers to a group automatically, one for each "source" of the same data. In other words, for a group trigger on CPU SystemLoad, add a member automatically for each source CPU reporting the 'SystemLoad' metric. By reporting data as a combination of source and dataId this should be possible. So, instead of reporting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Data(id:cpu-1-Load, value:123)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;d want:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Data(source:cpu-1, id:Load, value:123)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would then relieve the client from having to add member triggers up front and instead assume that the group will grow as needed, based on the incoming data.</p>
</div>
<div class="paragraph">
<p>Because dataIds are often defined upstream it is not always possible to supply Hawkular Alerting with data such that the source and id are separated.  But if possible this is a power ful approach.</p>
</div>
<div class="sect3">
<h4 id="_behavioral_notes">Behavioral Notes</h4>
<div class="paragraph">
<p>A couple of notes about data-driven group triggers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each member trigger is associated with a single source and only considers data from that source.</p>
<div class="ulist">
<ul>
<li>
<p>True for single and mult-condition triggers.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Condition changes in the group trigger will remove all member triggers.</p>
<div class="ulist">
<ul>
<li>
<p>The members will then again be created as the data demands.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <a href="#_source">Source</a> mechanism can also be used with manually managed triggers, if desired.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_alert_lifecycle">Alert Lifecycle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hawkular Alerting can integrate with other systems to handle Alert Lifecycle, but alerts can also be managed directly within the tool.  Hawkular Alerting supports a typical move through a simple lifecycle.  An alert starts in OPEN status, optionally moves to ACKNOWLEDGED to indicate the alert has been seen and the issue is being resolved, and is finally set to RESOLVED to indicate the problem has been fixed.</p>
</div>
<div class="sect2">
<h3 id="_autoresolve">AutoResolve</h3>
<div class="paragraph">
<p>Triggers require firing conditions and always start in <em>Firing</em> mode.  But the trigger can optionally supply autoResolve conditions. If <em>autoResolve=true</em> then after a trigger fires it switches to <em>AutoResolve</em> mode.  In AutoResolve mode the trigger no longer looks for problem conditions, but instead looks for evidence that the problem is resolved.  A simple example would be a trigger that has a firing condition of Availability DOWN, and an autoResolve condition of Availability UP.  This mechanism ensures that only one alert is generated for a problem, and that when the problem has been resolved, the trigger automatically returns to firing mode.</p>
</div>
<div class="paragraph">
<p>Moreover, if <em>autoResolveAlerts=true</em> then when the AutoResolve conditions are satisfied all of its unresolved alerts will be automatically set RESOLVED.</p>
</div>
<div class="paragraph">
<p>Like Firing mode, AutoResolveMode can optionally define its own dampening setting.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tags">Tags</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tags can have a variety of uses but are commonly used to assist in search.  Tags are free-formed name-value pairs and can be applied to:
* Triggers
* Alerts
* Events</p>
</div>
<div class="paragraph">
<p>Tags on triggers are automatically passed on to the Alerts or Events generated by that trigger.  This allows the same search criteria used to fetch triggers to also be used to fetch the alerts or events generated by those triggers.</p>
</div>
<div class="paragraph">
<p>A tag&#8217;s name and value must both be non-null.</p>
</div>
<div class="sect2">
<h3 id="_tags_query_language">Tags Query Language</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>&lt;tag_query&gt; ::= ( &lt;expression&gt; | "(" &lt;object&gt; ")"
| &lt;object&gt; &lt;logical_operator&gt; &lt;object&gt; )
&lt;expression&gt; ::= ( &lt;tag_name&gt; | &lt;not&gt; &lt;tag_name&gt;
| &lt;tag_name&gt; &lt;boolean_operator&gt; &lt;tag_value&gt;
| &lt;tag_name&gt; &lt;array_operator&gt; &lt;array&gt; )
&lt;not&gt; ::= [ "NOT" | "not" ]
&lt;logical_operator&gt; ::= [ "AND" | "OR" | "and" | "or" ]
&lt;boolean_operator&gt; ::= [ "=" | "!=" ]
&lt;array_operator&gt; ::= [ "IN" | "NOT IN" | "in" | "not in" ]
&lt;array&gt; ::= ( "[" "]" | "[" ( "," &lt;tag_value&gt; )* )
&lt;tag_name&gt; ::= &lt;identifier&gt;
&lt;tag_value&gt; ::= ( "'" &lt;regexp&gt; "'" | &lt;simple_value&gt; )
;
; &lt;identifier&gt; and &lt;simple_value&gt; follow pattern [a-zA-Z_0-9][\\-a-zA-Z_0-9]*
; &lt;regexp&gt; follows any valid Java Regular Expression format</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external_alert_integration">External Alert Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are times when an external system will already be looking for and detecting potential issues in its environment.  It is possible for these detection-only systems to leverage the power of Hawkular Alerting' trigger and action infrastructure.  For example, let&#8217;s say there is already a sensor in place looking for overheating situations.  When it detects something overheating it can take some action.  In this case we are not sending a stream of heat readings to alerting and having it evaluate against a threshold set on a trigger condition.  Instead, the threshold and evaluation are all built into the sensor.  To integrate with Hawkular Alerting we can use an "External Condition".</p>
</div>
<div class="sect2">
<h3 id="_external_conditions">External Conditions</h3>
<div class="paragraph">
<p>External integration begins with standard triggers.  In this way we immediately get everything that triggers offer: actions, dampening, lifecycle, auto-resolve, etc.  The difference is that instead of the typical condition types: Threshold, Availability, etc.., we can use an ExternalCondition. An external condition is like other conditions in that it has a 'dataId' with which it matches data sent into Hawkular Alerting.  It also has 'systemId' and 'expression' fields. The systemId is used to identify the external system for which the condition is relevant. In our example, perhaps "HeatSensors".  The expression field is used as needed.  In our example it may not be needed or it could be a description like, "sensor detected high temperature".  In other examples it could be used to store a complex expression that will be evaluated by the external system.</p>
</div>
<div class="paragraph">
<p>The main thing about external conditions is that they always evaluate to true.  It is assumed that when a datum comes in with a dataId assigned to an external condition that that condition immediately evaluates to true.  A trigger with a single external condition (and default dampening) would fire on every datum sent in for it&#8217;s condition.  This is because it is assumed the external system already did the work of determining there was an issue.</p>
</div>
<div class="paragraph">
<p>Note that the string data sent in has any value the external alerter system wants it to be.  In our example it may  be a sensorId and temperature, like "Sensor 5368, temperature 212F".</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_action_plugins">Action Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Plugins are responsible to execute actions when an alert, or possibly an event, happens.</p>
</div>
<div class="paragraph">
<p>Actions can be a notification task or a complex process.</p>
</div>
<div class="paragraph">
<p>Hawkular Alerting provide a plugin architecture to extend and add new behaviours.</p>
</div>
<div class="sect2">
<h3 id="_create_a_new_plugin">Create a new plugin</h3>
<div class="paragraph">
<p>We can add a new plugin in hawkular in several steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new project under <code>hawkular-alerts-actions-plugins</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can use an existing one as a template i.e. <code>hawkular-alerts-actions-generic</code>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Add an implementation of <code>org.hawkular.alerts.actions.api.ActionPluginListener</code> interface.</p>
</li>
<li>
<p>Add a plugin name to the implementation with the <code>org.hawkular.alerts.actions.api.ActionPlugin</code> annotation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@ActionPlugin(name = "file")
public class FilePlugin implements ActionPluginListener {
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_actionpluginlistener_interface">ActionPluginListener interface</h3>
<div class="paragraph">
<p>This interface has the responsability of</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define which properties and default values are supported by a plugin</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">...
    /**
     * The alerts engine registers the plugins available with their properties.
     * This method is invoked at plugin registration time.
     *
     * @return a list of properties available on this plugin
     */
    Set&lt;String&gt; getProperties();

    /**
     * The alerts engine registers the plugins available with their default values.
     * This method is invoked at plugin registration time.
     * Default values can be modified by the alerts engine.
     *
     *
     * @return a list of default values for properties available on this plugin
     */
    Map&lt;String, String&gt; getDefaultProperties();
...</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Process an incoming action message wrapped as a <code>org.hawkular.alerts.actions.api.ActionMessage</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">...
    /**
     * This method is invoked by the ActionService to process a new action generated by the engine.
     *
     * @param msg message received to be processed by the plugin
     * @throws Exception any problem
     */
    void process(ActionMessage msg) throws Exception;
...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_actionmessage_interface">ActionMessage interface</h3>
<div class="paragraph">
<p>This interface is a wrapper of the action sent by the engine with the effective properties to use by the plugin to
process it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package org.hawkular.alerts.actions.api;

import java.util.Map;

import org.hawkular.alerts.api.model.action.Action;

import com.fasterxml.jackson.annotation.JsonInclude;

/**
 * A message sent to the plugin from the alerts engine
 * It has the event payload as well as action properties
 *
 * @author Lucas Ponce
 */
public interface ActionMessage {

    @JsonInclude
    Action getAction();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class <code>org.hawkular.alerts.api.model.action.Action</code> is generated for the engine and it has the event detail as
part of its payload.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">/**
 * A base class for action representation from the perspective of the alerts engine.
 * An action is the abstract concept of a consequence of an event.
 * A Trigger definition can be linked with a list of actions.
 *
 * Alert engine only needs to know an action id and message/payload.
 * Action payload can optionally have an event as payload.
 *
 * Action plugins will be responsible to process the action according its own plugin configuration.
 *
 * @author Jay Shaughnessy
 * @author Lucas Ponce
 */
public class Action {

    @JsonInclude
    private String tenantId;

    @JsonInclude
    private String actionPlugin;

    @JsonInclude
    private String actionId;

    @JsonInclude(Include.NON_NULL)
    private String eventId;
...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_engine_extensions">Engine Extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Engine extensions are listeners that can operate on Data or Events received before the engine process them.</p>
</div>
<div class="paragraph">
<p>Extensions can implement a variety of use cases where transformation or filtering of incoming Data or Events might be necessary.</p>
</div>
<div class="paragraph">
<p>Extensions are executed in a pipeline ordered by registration time.</p>
</div>
<div class="paragraph">
<p>Extensions must implement a DataExtension or EventExtension interface and be registered through the <code>ExtensionsService</code>.</p>
</div>
<div class="sect2">
<h3 id="_dataextension_interface">DataExtension interface</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public interface DataExtension {

    /**
     * The extension processes the supplied Data and returns Data to be forwarded, if any.
     *
     * @param data The Data to be processed by the extension.
     * @return The set of Data to be forwarded to the next extension, or core engine if this is the final extension.
     */
    TreeSet&lt;Data&gt; processData(TreeSet&lt;Data&gt; data);

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_eventextension_interface">EventExtension interface</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public interface EventExtension {

    /**
     * The extension processes the supplied Events and returns Events to be forwarded, if any.
     *
     * @param events The Events to be processed by the extension.
     * @return The set of Events to be forwarded to the next extension, or core engine if this is the final extension.
     */
    TreeSet&lt;Event&gt; processEvents(TreeSet&lt;Event&gt; events);

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_events_aggregation_extension">Events Aggregation Extension</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Events Aggregation Extension allows to scope Sliding Windows on <em>Events</em> and define expressions on aggregated data.</p>
</div>
<div class="paragraph">
<p>To use this feature a <em>Trigger</em> must have the <em>HawkularExtension</em> tag with value <em>EventsAggregation</em>. It must then
define an <em>ExternalCondition</em> with the <em>alerterId</em> set to <em>EventsAggregation</em>, as shown in the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-json" data-lang="json">{
  "triggers":[
    {
      "trigger":{
        "id": "marketing-scenario",
        "name": "Marketing Scenario",
        "description": "Detect when a customer buys several items in a short period of time",
        "severity": "HIGH",
        "enabled": true,
        "actions":[
          {
            "actionPlugin": "email",
            "actionId": "notify-to-marketing"
          }
        ],
        "tags":{
            "HawkularExtension":"EventsAggregation"
        }
      },
      "conditions":[
        {
          "triggerMode": "FIRING",
          "type": "EXTERNAL",
          "alerterId":"EventsAggregation",
          "dataId": "marketing",
          "expression": "event:groupBy(context.accountId):window(time,10s):having(count &gt; 2)"
        }
      ]
    }
  ],
  "actions":[
    {
      "actionPlugin": "email",
      "actionId": "notify-to-marketing",
      "properties": {
        "to": "marketing@hawkular.org"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All events tagged with <em>HawkularExtension</em>=<em>EventsAggregation</em> will be filtered out and processed asynchronously by
the extension applying aggregated rules defined in the ExternalCondition expressions.</p>
</div>
<div class="sect2">
<h3 id="_events_aggregation_expressions">Events Aggregation Expressions</h3>
<div class="paragraph">
<p>An <em>ExternalCondition</em> used for <em>EventsAggregation</em> alerter defines a DSL expression which is parsed internally by the
extension into a DRL format understandable by the JBoss Rules CEP engine.</p>
</div>
<div class="paragraph">
<p>The DSL expression defines Event grouping by fields and additional filtering options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>&lt;expression&gt; ::= "event:groupBy(" &lt;field&gt; ")" [ ":window(" &lt;window&gt; ")" ] [ ":filter(" &lt;filter&gt; ] [ ":having(" &lt;having&gt; ")" ]

&lt;field&gt; ::= [ "tag." | "context." ] &lt;field name&gt;

&lt;window&gt; ::= ( "time," &lt;time_value&gt; | "length," &lt;numeric_value&gt; )

&lt;time_value&gt; ::= [ &lt;numeric_value&gt; "d" ][ &lt;numeric_value&gt; "h" ][ &lt;numeric_value&gt; "m" ][ &lt;numeric_value&gt; "s" ] [ &lt;numeric_value&gt; [ "ms" ]]

&lt;filter&gt; ::= &lt;drools_expression&gt;

&lt;having&gt; ::= &lt;drools_expression&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, the expression</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>event:groupBy(context.accountId):window(time,10s):having(count &gt; 2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be described as follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>groupBy(context.accountId)      Group window events by context "accountId" field
window(time,10s)                Define a sliding time window of 10 seconds
having(count &gt; 2)               Define an expression on the grouped events</code></pre>
</div>
</div>
<div class="paragraph">
<p>In other words, this condition will be true, each time that there are more than two events with the same <em>accountId</em> in a 10 seconds window.</p>
</div>
<div class="paragraph">
<p>The DSL can operate on Events fields, as well as context and tags, as it is shown in the previous example and here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>event:groupBy(tags.accountId):window(time,10s):having(count &gt; 1, count.tags.location &gt; 1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>groupBy(context.accountId)                    Group window events by context "accountId" field
window(time,10s)                              Define a sliding time window of 10 seconds
having(count &gt; 1, count.tags.location &gt; 1)    Define an expression on the grouped events</code></pre>
</div>
</div>
<div class="paragraph">
<p>This condition will be true when there are more than 1 events with more than one <em>location</em> tag, so detecting when
events for the same <em>accountId</em> happens from different places.</p>
</div>
<div class="paragraph">
<p>The two previous expressions group all events for the timing window.</p>
</div>
<div class="paragraph">
<p>We might have scenarios where only specific events should be grouped.</p>
</div>
<div class="paragraph">
<p>For these cases we can add filters into the expressions like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>event:groupBy(tags.traceId):filter((category == "Credit Check" &amp;&amp; text == "Exceptionally Good") || (category == "Stock Check" &amp;&amp; text == "Out of Stock")):having(count &gt; 1, count.tags.accountId == 1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This expression will group events filtered by an expression</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>filter(
    (category == "Credit Check" &amp;&amp; text == "Exceptionally Good") ||
    (category == "Stock Check" &amp;&amp; text == "Out of Stock")
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this expression doesn&#8217;t define an explicit sliding time window, so it will use a default expiration window.</p>
</div>
<div class="paragraph">
<p>Additional details can be consulted on the JavaDoc of the implementation and examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/hawkular/hawkular-alerts/blob/master/hawkular-alerts-engine-extensions/hawkular-alerts-events-aggregation/src/main/java/org/hawkular/alerts/extensions/Expression.java">Events Aggregation Expression JavaDoc</a></p>
</li>
<li>
<p><a href="https://github.com/hawkular/hawkular-alerts/tree/master/examples/events-aggregation">Events Aggregation Expression Examples</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_elasticsearch_integration">Elasticsearch Integration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_elasticsearch_alerter">Elasticsearch Alerter</h3>
<div class="paragraph">
<p>The Elasticsearch Alerter will listen for triggers tagged with "Elasticsearch". The Alerter will schedule a
periodic query to an Elasticsearch system with the info provided from the tagged trigger&#8217;s context. The Alerter
will convert Elasticsearch documents into Hawkular Alerting Events and send them into the Alerting engine.</p>
</div>
<div class="paragraph">
<p>The Elasticsearch Alerter uses the following conventions for trigger tags and context:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Required</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>trigger.tags["Elasticsearch"] = "&lt;any description&gt;"</em><br>
<br>
An <em>Elasticsearch</em> tag is required for the alerter to detect this trigger will query to an Elasticsearch system.<br>
Value is not necessary, it can be used as a description, it is reserved for future uses.<br>
<br>
i.e.
<br>
trigger.tags["Elasticsearch"] = ""                          // Empty value is valid<br>
trigger.tags["Elasticsearch"] = "OpenShift Logging System"  // It can be used as description</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Required</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>trigger.context["timestamp"] = "&lt;timestamp field&gt;"</em><br>
<br>
This defines the timestamp field name for the fetched Elasticsearch documents.<br>
The timestamp field is used to fetch documents on an interval basis, without overlap.<br>
<br>
If there is not defined a specific pattern under the trigger.context["timestamp.pattern"] it will follow the default patterns:<br>
<br>
"yyyy-MM-dd&#8217;T&#8217;HH:mm:ss.SSSSSSZ"<br>
"yyyy-MM-dd&#8217;T&#8217;HH:mm:ssZ"</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Required</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>trigger.context["mapping"] = "&lt;mapping_expression&gt;"</em><br>
<br>
A mapping expression defines how to convert an Elasticsearch document into a Hawkular Event.<br>
<br>
Mapping expression syntax (BNF):<br>
<br>
&lt;mapping_expression&gt; ::= &lt;mapping&gt; | &lt;mapping&gt; "," &lt;mapping_expression&gt;<br>
<br>
&lt;mapping&gt; ::= &lt;elasticsearch_field&gt; [ "|" "'" &lt;DEFAULT_VALUE&gt; "'" ] ":" &lt;hawkular_event_field&gt;
<br>
&lt;elasticsearch_field&gt; ::= "index" | "id" | &lt;SOURCE_FIELD&gt;<br>
<br>
&lt;hawkular_event_field&gt; ::= "id" | "ctime" | "dataSource" | "dataId" | "category" | "text" | "context" | "tags"<br>
<br>
A minimum mapping for the "dataId" is required.<br>
If a mapping is not present in an Elasticsearch document it will return an empty value.<br>
It is possible to define a default value for cases when the Elasticsearch field is not present.<br>
Special Elasticsearch metafields "_index" and "_id" are supported under "index" and "id" labels.<br>
<br>
i.e.
<br>
trigger.context["mapping"] = "level|'INFO':category,@timestamp:ctime,message:text,hostname:dataId,index:tags"<br></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Optional</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>trigger.context["interval"] = "[0-9]+[smh]"</em><br>
<br>
Defines the time interval between queries of the Elasticsearch system.<br>
If not provided the default is "2m" (two minutes).<br>
<br>
i.e.
<br>
trigger.context["interval"] = "30s"<br>
<br>
performs a new query 30 seconds after completing the previous query, fetching documents generated since that time, using the timestamp field provided in <em>trigger.context["timestamp"]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Optional</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>trigger.context["timestamp_pattern"] = "&lt;date and time pattern&gt;"</em><br>
<br>
Defines a new time pattern for the trigger.context["timestamp"]. It must follow supported formats of <a href="https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html">java.text.SimpleDateFormat</a>.
If it is not present, it will expect default patterns:<br>
<br>
"yyyy-MM-dd&#8217;T&#8217;HH:mm:ss.SSSSSSZ"<br>
"yyyy-MM-dd&#8217;T&#8217;HH:mm:ssZ"</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Optional</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>trigger.context["index"] = "&lt;elastic_search_index&gt;"</em><br>
<br>
Defines the index or indexes where the documents will be queried. If not defined the query will search under all defined indexes.<br>
Elasticsearch wildcards are supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Optional</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>trigger.context["filter"] = "&lt;elastic_search_query_filter&gt;"</em><br>
<br>
By default the Elasticsearch Alerter performs a range query over the timestamp field provided in the alerter tag.<br>
This query accepts an additional filter in Elasticsearch format. The final query should be built from:<br>
<br>
{"query": {"constant_score": {"filter": {"bool": {"must": [&lt;range_query_on_timestamp&gt;, &lt;elastic_search_query_filter&gt;] }}}}}</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Optional</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>trigger.context["url"]</em><br>
<br>
Elasticsearch url can be defined in several ways in the alerter.<br>
See <a href="#_elasticsearch_security">Elasticsearch Security</a>.<br>
<br>
In addition to the methods defined, a trigger can overwrite the url to which it connects.<br>
Url can be a list of valid <a href="https://hc.apache.org/httpcomponents-core-ga/httpcore/apidocs/org/apache/http/HttpHost.html">org.apache.http.HttpHost</a> urls. By default it will point to<br>
<br>
trigger.context["url"] = "http://localhost:9200"<br>
<br>
i.e. a valid url could be
<br>
trigger.context["url"] = "http://host1:9200,http://host2:9200,http://host3:9200"</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A complete example of an Elasticsearch trigger:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-json" data-lang="json">    {
      "trigger":{
        "id": "trigger-project",
        "name": "Project Logging Trigger",
        "description": "Alert on Project Logging (EFK infrastructure)",
        "severity": "HIGH",
        "enabled": true,
        "tags": {
          "Elasticsearch": "Demo ES instance"
        },
        "context": {
          "timestamp": "@timestamp",
          "interval": "30s",
          "index": "project.logging*",
          "mapping": "type|'Unknown':category,@timestamp:ctime,message:text,hostname:dataId,index:tags"
        },
        "actions":[
          {
            "actionPlugin": "elasticsearch",
            "actionId": "write-full-alert"
          },
          {
            "actionPlugin": "elasticsearch",
            "actionId": "write-partial-alert"
          },
          {
            "actionPlugin": "email",
            "actionId": "email-to-admins"
          }
        ]
      },
      "conditions":[
        {
          "type": "EVENT",
          "dataId": "192.168.122.198",
          "expression": "category == 'response'"
        }
      ]
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_elasticsearch_action_plugin">Elasticsearch Action Plugin</h3>
<div class="paragraph">
<p>This plugin processes Actions writing Event/Alerts into an Elasticsearch system.<br>
<br>
The Elasticsearch plugin supports the following properties:<br>
<br></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 66.6666%;">
<col style="width: 16.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>url</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#_elasticsearch_security">Elasticsearch Security</a>.<br>
<br>
Indicate the Elasticsearch server or servers to connect.<br></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><a href="http://localhost:9200" class="bare">http://localhost:9200</a></em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>index</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicate the index where the Events/Alerts will be written.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>alerts</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the type under the index where the Events/Alerts will be written.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>hawkular</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>transform</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define an optional transformation expression based on JOLT Shiftr format to convert an Event/Alert into a custom JSON format.<br>
<br>
i.e.<br>
{"tenantId":"tenant","ctime":"timestamp","dataId":"dataId","context":"context"}<br>
<br>
<a href="https://github.com/bazaarvoice/jolt/blob/master/jolt-core/src/main/java/com/bazaarvoice/jolt/Shiftr.java">JOLT Shiftr JavaDoc</a><br>
<a href="http://jolt-demo.appspot.com/">JOLT Online tool</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#_elasticsearch_security">Elasticsearch Security</a>.<br>
<br>
Username for Basic credential authentication.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>pass</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#_elasticsearch_security">Elasticsearch Security</a>.<br>
<br>
Password for Basic credential authentication.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>forwarded-for</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#_elasticsearch_security">Elasticsearch Security</a>.<br>
<br>
Used for X-Forwarded-For HTTP header.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>proxy-remote-user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#_elasticsearch_security">Elasticsearch Security</a>.<br>
<br>
Used for X-Proxy-Remote-User HTTP header</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>token</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#_elasticsearch_security">Elasticsearch Security</a>.<br>
<br>
Used for Bearer HTTP authentication</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>timestamp_pattern</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alerts and Events use timestamps format for <em>ctime,stime,evalTimestamp,dataTimestamp</em> fields.<br>
If present, this property defines the output pattern of these fields when using a declared <strong>transform</strong>.<br>
It must follow supported formats of <a href="https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html">java.text.SimpleDateFormat</a>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Examples of Elasticsearch actions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-json" data-lang="json">  "actions":[
    {
      "actionPlugin": "elasticsearch",
      "actionId": "write-full-alert",
      "properties": {
        "index": "alerts_full"
      }
    },
    {
      "actionPlugin": "elasticsearch",
      "actionId": "write-partial-alert",
      "properties": {
        "index": "alerts_summary",
        "timestamp.pattern": "yyyy-MM-dd'T'HH:mm:ss.SSSSSSZ",
        "transform": "{\"tenantId\":\"tenant\",\"ctime\":\"timestamp\",\"text\":\"trigger\",\"context\":{\"interval\":\"fetch-interval\"},\"evalSets\":\"details\"}"
      }
    }
  ]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_elasticsearch_security">Elasticsearch Security</h3>
<div class="paragraph">
<p>Hawkular Elasticsearch integration is supported on <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/index.html">Elasticsearch REST client</a>.<br>
<br>
There are several ways to configure a secure connection between Hawkular Alerting and Elasticsearch: Basic authentication, certificates or tokens.<br>
<br>
Basic authentication can be defined on triggers and actions as described in the previous sections.
For certificates or token authentication is recommended to use the following system properties or ENV variables.<br>
<br></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">System property</th>
<th class="tableblock halign-center valign-top">Environment variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">javax.net.ssl.trustStore</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the Java keystore file containing the collection of CA certificates trusted by this application process (trust store).<br>
<br>
See <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html">JSSE Reference Guide</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">javax.net.ssl.trustStorePassword</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password to access the private key from the keystore file specified by javax.net.ssl.trustStore.<br>
<br>
See <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html">JSSE Reference Guide</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">javax.net.ssl.keyStore</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the Java keystore file containing an application process&#8217;s own certificate and private key.<br>
<br>
See <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html">JSSE Reference Guide</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">javax.net.ssl.keyStorePassword</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password to access the private key from the keystore file specified by javax.net.ssl.keyStore.<br>
<br>
See <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html">JSSE Reference Guide</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">hawkular-alerts.elasticsearch-url</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ELASTICSEARCH_URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicate the Elasticsearch server or servers to connect.<br>
Url can be a list of valid <a href="https://hc.apache.org/httpcomponents-core-ga/httpcore/apidocs/org/apache/http/HttpHost.html">org.apache.http.HttpHost</a> urls.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">hawkular-alerts.elasticsearch-forwarded-for</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ELASTICSEARCH_FORWARDED_FOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for X-Forwarded-For HTTP header.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">hawkular-alerts.elasticsearch-token</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ELASTICSEARCH_TOKEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for Bearer HTTP authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">hawkular-alerts.elasticsearch-proxy-remote-user</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ELASTICSEARCH_PROXY_REMOTE_USER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for X-Proxy-Remote-User HTTP header.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rest_api">REST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hawkular Alerting supports a robust REST API for managing Triggers, Alerts and Events.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.hawkular.org/docs/rest/rest-alerts-v2.html">Hawkular Alerting REST API</a></p>
</li>
</ul>
</div>
</div>
</div>
      </div>
    </section>

		</div>
		<div id="push"></div>
    </div>

    <section class="redhat clearfix">
      <div class="container">
        <p class="pull-left">
          <a href="http://www.redhat.com/">
            <img alt="redhatlogo-white" src="../../..//img/redhatlogo-white.png" width="130">
          </a>
        </p>
        <p class="muted credit pull-right">
				  &copy; 2016 | Hawkular is released under <a href="/license.html">Apache License v2.0</a>
					<a href="https://twitter.com/hawkular_org" class="twitter-follow-button" data-show-count="false" data-size="medium">Follow @hawkular_org</a>
				  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
					<iframe src="https://ghbtns.com/github-btn.html?user=hawkular&repo=hawkular-services&type=star" frameborder="0" scrolling="0" class="github-stars-btn"></iframe>
				</p>

    <!--p id="forkongithubp"><span id="forkongithub">
      <a href="https://github.com/hawkular" class="bg-grey">
        Fork me on GitHub
      </a>
    </span></p-->
      </div>
    </section>

    <!-- javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- js -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="../../../js/jbossorg-tabzilla.js"></script>
    <script src="../../../js/behavior.js"></script>
    <script src="../../../js/prettify.js"></script>
    <script src="../../../js//ekko-lightbox.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'hawkular';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61728352-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
