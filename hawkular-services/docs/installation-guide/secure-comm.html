<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Hawkular - Securing Communications</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- css -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="../../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link href="../../../css/tabzilla.css" rel="stylesheet">
    <link href="../../../css/styles.css" rel="stylesheet">
    <link href="../../../css/prettify.css" rel="stylesheet">
    <link href="../../../css/ekko-lightbox.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
    <script src="../../../js/moment.min.js"></script>
    <script src="../../../js/jquery-1.11.2.min.js"></script>

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../favicon.ico">
    
  </head>
  <body onload="prettyPrint()" data-spy="scroll" data-offset="80" data-target="#toc">


<!-- Fixed navbar -->
<nav class="navbar navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <a class="navbar-brand" href="../../..//">Home</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="../../../blog.html" role="button">Blog</a></li>
        <li class="dropdown"><a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
          Community
          <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" role="menu">
            <li class="menu-item">
              <a href="../../../community/docs/getting-involved/">Getting Involved</a>
            </li>
            <li class="menu-item">
              <a href="../../../community/docs/developer-guide/">Developer Guide</a>
            </li>
            <li class="menu-item dropdown dropdown-submenu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Labs</a>
                <ul class="dropdown-menu">
                  <li class="menu-item ">
                    <a href="../../../community/labs/datamining/">Datamining</a>
                  </li>
                  <li class="menu-item ">
                    <a href="https://github.com/pilhuhn/hawkfx">HawkFX</a>
                  </li>
                  <li class="menu-item ">
                    <a href="../../../hawkular-clients/android-client/">Android client</a>
                  </li>
                  <li class="menu-item ">
                    <a href="https://github.com/jotak/hawkular-java-toolbox">Client-side java toolbox</a>
                  </li>
                </ul>
            </li>
            <li>
              <a href="https://github.com/hawkular">GitHub Repositories</a>
            <li>
              <a href="https://travis-ci.org/hawkular">CI Builds</a>
            </li>
          </ul>
        </li>
      </ul>
      <div id="wrap">
        <div class="dropup">
          <a class="tabnav-closed" href="#" id="tab">Red Hat</a>
          <script>
            window.addEventListener('load', function() {
              renderTabzilla("Hawkular", "https://hawkular.github.io", true );
            }, false);
          </script>
        </div>
      </div>
    </div>
</nav>

      <section class="main-banner">
        <div class="container">
          <h1>Securing Communications</h1>
          <p>Turning on secure communications (ssl / https) in Hawkular</p>
<!-- show tags for this page -->
        </div>

      </section>

	<!--<p><em>12 October 2015</em></p>-->

	<section>
      <div class="container">
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#_securing_communications">Securing Communications</a>
<ul class="sectlevel2">
<li><a href="#_generating_a_self_signed_certificate_if_needed">Generating A Self-Signed Certificate (if needed)</a></li>
<li><a href="#_make_your_certificate_trusted">Make Your Certificate Trusted</a></li>
<li><a href="#_configure_hawkular_server">Configure Hawkular Server</a></li>
<li><a href="#_ready">Ready</a></li>
<li><a href="#_more_details">More Details</a></li>
</ul>
</li>
<li><a href="#_securing_communications_between_agent_and_a_managed_wildfly_server">Securing Communications Between Agent and a Managed WildFly Server</a>
<ul class="sectlevel2">
<li><a href="#_securing_the_management_interface_of_the_managed_wildfly_server">Securing the Management Interface of the Managed WildFly Server</a></li>
<li><a href="#_configuring_the_agent_for_secure_communications_to_managed_wildfly_server">Configuring the Agent For Secure Communications to Managed WildFly Server</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_securing_communications">Securing Communications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Please follow the instructions in the <a href="quick-start.html">Quick Start document</a> for the server itself, followed by the instructions below.</p>
</div>
<div class="paragraph">
<p>These instructions will tell you how to prepare the Hawkular Server to support secure communications via SSL/https.
Following these instructions will enable browsers to access the Hawkular GUI over https as well as allowing
the UI clients and feeds to access the Hawkular Server over "wss" (WebSockets over SSL).</p>
</div>
<div class="sect2">
<h3 id="_generating_a_self_signed_certificate_if_needed">Generating A Self-Signed Certificate (if needed)</h3>
<div class="paragraph">
<p>If you do not have a keystore with your own private key/certificate, you can generate a self-signed cert.
Since it will be assumed you are doing this for testing and demo purposes only, the below instructions will generate a
valid certificate for your localhost only (see "CN=localhost" and the Subject Alternative Name of 127.0.0.1):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">keytool -genkey -keystore hawkular.keystore -alias hawkular -dname "CN=localhost" -keyalg RSA -storepass hawkular -keypass hawkular -validity 36500 -ext san=ip:127.0.0.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure your new "hawkular.keystore" is copied to your Hawkular Server&#8217;s standalone/configuration directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="_make_your_certificate_trusted">Make Your Certificate Trusted</h3>
<div class="paragraph">
<p>If you created your own self-signed certificate (or you have one signed by your own CA that your Java VM does not yet know about or trust),
you will need to tell your Java VM that it can trust it. You do this by adding your certificate to the "cacerts" file.</p>
</div>
<div class="paragraph">
<p>First, export your certificate from your keystore file (hawkular.keystore if you followed instructions in step 1) into a file called hawkular.cert:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">keytool -export -alias hawkular -file hawkular.cert -storepass hawkular -keystore hawkular.keystore</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now import your certificate into your Java&#8217;s CA certificates file - this makes your certificate trusted by your Java apps
(note this assumes the default password of "changeit" in your Java install&#8217;s cacerts file - obviously, you&#8217;ll want to
use the correct password if you changed it):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">keytool -import -keystore $JAVA_HOME/jre/lib/security/cacerts -alias hawkular -storepass changeit -file hawkular.cert</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can examine your certificate and answer the prompt to indicate you do trust that certificate.
If you want to automate this, you can pass in the -noprompt command line argument and it will automatically add the certificate without asking you for confirmation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configure_hawkular_server">Configure Hawkular Server</h3>
<div class="paragraph">
<p>Now that your keystore is generated and trusted, you have to tell the Hawkular Server to use your keystore when using SSL.</p>
</div>
<div class="paragraph">
<p>First, you must add two security-realm elements in standalone/configuration/standalone.xml. Note that we create one for use by the Undertow web connector and one for use by the Hawkular Agent that comes with the Hawkular Server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;management&gt;
  &lt;security-realms&gt;
    &lt;security-realm name="UndertowRealm"&gt;
      &lt;server-identities&gt;
        &lt;ssl&gt;
          &lt;keystore path="hawkular.keystore" relative-to="jboss.server.config.dir" keystore-password="hawkular" key-password="hawkular" alias="hawkular" /&gt;
        &lt;/ssl&gt;
      &lt;/server-identities&gt;
    &lt;/security-realm&gt;
    &lt;security-realm name="HawkularAgentRealm"&gt;
      &lt;authentication&gt;
        &lt;truststore path="hawkular.keystore" relative-to="jboss.server.config.dir" keystore-password="hawkular" /&gt;
      &lt;/authentication&gt;
    &lt;/security-realm&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next add an HTTPS listener to standalone.xml, using your new security-realm that is configured with your new keystore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">  &lt;subsystem xmlns="urn:jboss:domain:undertow:2.0" statistics-enabled="true"&gt;
  ...
    &lt;server name="default-server"&gt;
      &lt;https-listener name="https" security-realm="UndertowRealm" socket-binding="https"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, turn on SSL in the agent by adding these two attributes to the &lt;storage-adapter&gt; element in standalone.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">  &lt;storage-adapter use-ssl="true" security-realm="HawkularAgentRealm" ... /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ready">Ready</h3>
<div class="paragraph">
<p>You are now ready to access the Hawkular Server via "https://localhost:8443". The agent and any other feeds that want to send data
to the Hawkular Server can do so over "wss://localhost:8443".</p>
</div>
</div>
<div class="sect2">
<h3 id="_more_details">More Details</h3>
<div class="paragraph">
<p>For more details, see the Keycloak documentation here: <a href="http://keycloak.github.io/docs/userguide/html_single/index.html#ssl_modes" class="bare">http://keycloak.github.io/docs/userguide/html_single/index.html#ssl_modes</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_securing_communications_between_agent_and_a_managed_wildfly_server">Securing Communications Between Agent and a Managed WildFly Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The above instructions tell you how to secure your Hawkular Server and how the Hawkular WildFly Agent can talk to the Hawkular Server over that secured communications channel. But this does nothing to secure the communications between the agent and the remote WildFly Servers the agent is monitoring. To secure this communications channel, the following must be performed.</p>
</div>
<div class="sect2">
<h3 id="_securing_the_management_interface_of_the_managed_wildfly_server">Securing the Management Interface of the Managed WildFly Server</h3>
<div class="paragraph">
<p>You first must ensure that the managed WildFly Server provides a secure management interface. You do this by changing its configured management interface. In the managed WildFly Server standalone.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;management-interfaces&gt;
  &lt;http-interface http-upgrade-enabled="true" security-realm="ManagementRealm"&gt;
    &lt;socket-binding https="management-https"&gt;
  &lt;/http-interface&gt;
&lt;/management-interfaces&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is essentially the same as the out-of-box WildFly management interface except for two changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The socket-binding now has an attribute "https" to denote the management interface must be accessed over HTTPS.</p>
</li>
<li>
<p>The socket-binding&#8217;s https attribute has a value of "management-https" (as opposed to management-http) to denote the port that the management interface should listen to is that of the secure HTTPS port. "management-https" is a defined &lt;socket-binding&gt; that you will find out-of-box in the &lt;socket-binding-group&gt; section.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next thing you must do is provide a keystore for the ManagementRealm to use now that you are requiring SSL. This is the same kind of configuration that was performed above when securing the Hawkular Server, but instead of creating a new security-realm, you normally only have to add a &lt;server-identities&gt; section to the already existing, out-of-box, security-realm called "ManagementRealm". You need to obtain a keystore with your managed WildFly Server&#8217;s certificate, put it in the managed WildFly Server&#8217;s configuration directory, and add a server-identities element to the ManagementRealm security-realm in standalone.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;management&gt;
  &lt;security-realms&gt;
    &lt;security-realm name="ManagementRealm"&gt;
      ...
      &lt;server-identities&gt;
        &lt;ssl&gt;
          &lt;keystore path="your-wildfly.keystore" relative-to="jboss.server.config.dir" keystore-password="your-password" key-password="your-password" alias="your-alias" /&gt;
        &lt;/ssl&gt;
      &lt;/server-identities&gt;
    &lt;/security-realm&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, your managed WildFly Server will only accept secure communications over its management interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_the_agent_for_secure_communications_to_managed_wildfly_server">Configuring the Agent For Secure Communications to Managed WildFly Server</h3>
<div class="paragraph">
<p>The above only configured the managed WildFly Server itself. You then have to tell the Hawkular WildFly Agent to talk to that managed server over the secure interface. You do this by first creating a security-realm in the agent&#8217;s WildFly Server container with the managed WildFly Server&#8217;s certificate in the given keystore (remember this is now editing the <em>agent&#8217;s</em> WildFly Server standalone.xml):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;management&gt;
  &lt;security-realms&gt;
    &lt;security-realm name="ManagedWildFlyRealm"&gt;
      &lt;authentication&gt;
        &lt;truststore path="your-wildfly.keystore" relative-to="jboss.server.config.dir" keystore-password="your-password"/&gt;
      &lt;/authentication&gt;
    &lt;/security-realm&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now tell the agent to talk to the managed WildFly Server securely by setting the "use-ssl" and "security-realm" attributes in the appropriate &lt;remote-dmr&gt; server entry in standalone.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;managed-servers&gt;
  &lt;remote-dmr use-ssl="true" security-realm="ManagedWildFlyRealm" ... /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, the agent will be able to talk to the managed WildFly Server over the secure management interface.</p>
</div>
</div>
</div>
</div>
      </div>
    </section>

		</div>
		<div id="push"></div>
    </div>

    <section class="redhat clearfix">
      <div class="container">
        <p class="pull-left">
          <a href="http://www.redhat.com/">
            <img alt="redhatlogo-white" src="../../..//img/redhatlogo-white.png" width="130">
          </a>
        </p>
        <p class="muted credit pull-right">
				  &copy; 2016 | Hawkular is released under <a href="/license.html">Apache License v2.0</a>
					<a href="https://twitter.com/hawkular_org" class="twitter-follow-button" data-show-count="false" data-size="medium">Follow @hawkular_org</a>
				  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
					<iframe src="https://ghbtns.com/github-btn.html?user=hawkular&repo=hawkular-services&type=star" frameborder="0" scrolling="0" class="github-stars-btn"></iframe>
				</p>

    <!--p id="forkongithubp"><span id="forkongithub">
      <a href="https://github.com/hawkular" class="bg-grey">
        Fork me on GitHub
      </a>
    </span></p-->
      </div>
    </section>

    <!-- javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- js -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <script src="../../../js/jbossorg-tabzilla.js"></script>
    <script src="../../../js/behavior.js"></script>
    <script src="../../../js/prettify.js"></script>
    <script src="../../../js//ekko-lightbox.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'hawkular';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61728352-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
